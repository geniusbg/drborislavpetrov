"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/admin/voice-commands/route";
exports.ids = ["app/api/admin/voice-commands/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "sqlite3":
/*!**************************!*\
  !*** external "sqlite3" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("sqlite3");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fvoice-commands%2Froute&page=%2Fapi%2Fadmin%2Fvoice-commands%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fvoice-commands%2Froute.ts&appDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fvoice-commands%2Froute&page=%2Fapi%2Fadmin%2Fvoice-commands%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fvoice-commands%2Froute.ts&appDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_genius_Downloads_drborislavpetrov_src_app_api_admin_voice_commands_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/admin/voice-commands/route.ts */ \"(rsc)/./src/app/api/admin/voice-commands/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/admin/voice-commands/route\",\n        pathname: \"/api/admin/voice-commands\",\n        filename: \"route\",\n        bundlePath: \"app/api/admin/voice-commands/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\genius\\\\Downloads\\\\drborislavpetrov\\\\src\\\\app\\\\api\\\\admin\\\\voice-commands\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_genius_Downloads_drborislavpetrov_src_app_api_admin_voice_commands_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/admin/voice-commands/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhZG1pbiUyRnZvaWNlLWNvbW1hbmRzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhZG1pbiUyRnZvaWNlLWNvbW1hbmRzJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYWRtaW4lMkZ2b2ljZS1jb21tYW5kcyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNnZW5pdXMlNUNEb3dubG9hZHMlNUNkcmJvcmlzbGF2cGV0cm92JTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNnZW5pdXMlNUNEb3dubG9hZHMlNUNkcmJvcmlzbGF2cGV0cm92JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUM4QztBQUMzSDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2RyLWJvcmlzbGF2LXBldHJvdi13ZWJzaXRlLz83MDlkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXGdlbml1c1xcXFxEb3dubG9hZHNcXFxcZHJib3Jpc2xhdnBldHJvdlxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxhZG1pblxcXFx2b2ljZS1jb21tYW5kc1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYWRtaW4vdm9pY2UtY29tbWFuZHMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hZG1pbi92b2ljZS1jb21tYW5kc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYWRtaW4vdm9pY2UtY29tbWFuZHMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxnZW5pdXNcXFxcRG93bmxvYWRzXFxcXGRyYm9yaXNsYXZwZXRyb3ZcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcYWRtaW5cXFxcdm9pY2UtY29tbWFuZHNcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2FkbWluL3ZvaWNlLWNvbW1hbmRzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fvoice-commands%2Froute&page=%2Fapi%2Fadmin%2Fvoice-commands%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fvoice-commands%2Froute.ts&appDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/admin/voice-commands/route.ts":
/*!***************************************************!*\
  !*** ./src/app/api/admin/voice-commands/route.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! sqlite3 */ \"sqlite3\");\n/* harmony import */ var sqlite3__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(sqlite3__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var sqlite__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! sqlite */ \"(rsc)/./node_modules/sqlite/build/index.mjs\");\n/* eslint-disable @typescript-eslint/no-explicit-any */ \n\n\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const command = body;\n        console.log(\"Received voice command:\", command);\n        if (!command.action) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Невалидна команда\"\n            });\n        }\n        const db = await (0,sqlite__WEBPACK_IMPORTED_MODULE_2__.open)({\n            filename: \"bookings.db\",\n            driver: (sqlite3__WEBPACK_IMPORTED_MODULE_1___default().Database)\n        });\n        let result = {};\n        switch(command.action){\n            case \"addUser\":\n                result = await handleAddUser(db, command);\n                break;\n            case \"updateUser\":\n                result = await handleUpdateUser(db, command);\n                break;\n            case \"deleteUser\":\n                result = await handleDeleteUser(db, command);\n                break;\n            case \"addBooking\":\n                result = await handleAddBooking(db, command);\n                break;\n            case \"updateBooking\":\n                result = await handleUpdateBooking(db, command);\n                break;\n            case \"cancelBooking\":\n                result = await handleCancelBooking(db, command);\n                break;\n            case \"checkAvailability\":\n                result = await handleCheckAvailability(db, command);\n                break;\n            case \"showBookings\":\n                result = await handleShowBookings(db, command);\n                break;\n            default:\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    success: false,\n                    error: \"Неразпозната команда\"\n                });\n        }\n        await db.close();\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(result);\n    } catch (error) {\n        console.error(\"Voice command error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Грешка при обработка на командата\"\n        });\n    }\n}\nasync function handleAddUser(db, command) {\n    const { name, phone, email } = command;\n    if (!name) {\n        return {\n            success: false,\n            error: \"Името е задължително\"\n        };\n    }\n    // Generate unique phone if not provided\n    let userPhone = phone;\n    if (!userPhone) {\n        const timestamp = Date.now();\n        userPhone = `0888${timestamp.toString().slice(-6)}`;\n    }\n    // Format phone number\n    userPhone = formatPhoneNumber(userPhone);\n    // Check if user already exists\n    const existingUser = await db.get(\"SELECT * FROM users WHERE phone = ?\", [\n        userPhone\n    ]);\n    if (existingUser) {\n        return {\n            success: false,\n            error: `Потребител с телефон ${userPhone} вече съществува`\n        };\n    }\n    // Capitalize name\n    const capitalizedName = capitalizeName(name);\n    await db.run(\"INSERT INTO users (name, phone, email) VALUES (?, ?, ?)\", [\n        capitalizedName,\n        userPhone,\n        email || null\n    ]);\n    return {\n        success: true,\n        message: `Потребителят ${capitalizedName} е добавен успешно с телефон ${userPhone}`\n    };\n}\nasync function handleUpdateUser(db, command) {\n    const { name, phone, email } = command;\n    if (!name) {\n        return {\n            success: false,\n            error: \"Името е задължително\"\n        };\n    }\n    // Find user by name (case insensitive)\n    const user = await db.get(\"SELECT * FROM users WHERE LOWER(name) = LOWER(?)\", [\n        name\n    ]);\n    if (!user) {\n        return {\n            success: false,\n            error: `Потребителят ${name} не е намерен`\n        };\n    }\n    const updateFields = [];\n    const updateValues = [];\n    if (phone) {\n        const formattedPhone = formatPhoneNumber(phone);\n        // Check if new phone already exists\n        const existingUser = await db.get(\"SELECT * FROM users WHERE phone = ? AND id != ?\", [\n            formattedPhone,\n            user.id\n        ]);\n        if (existingUser) {\n            return {\n                success: false,\n                error: `Телефон ${formattedPhone} вече се използва от друг потребител`\n            };\n        }\n        updateFields.push(\"phone = ?\");\n        updateValues.push(formattedPhone);\n        // Migrate bookings to new phone\n        await db.run(\"UPDATE bookings SET phone = ? WHERE phone = ?\", [\n            formattedPhone,\n            user.phone\n        ]);\n    }\n    if (email) {\n        updateFields.push(\"email = ?\");\n        updateValues.push(email);\n    }\n    if (updateFields.length === 0) {\n        return {\n            success: false,\n            error: \"Не са посочени данни за промяна\"\n        };\n    }\n    updateValues.push(user.id);\n    await db.run(`UPDATE users SET ${updateFields.join(\", \")} WHERE id = ?`, updateValues);\n    return {\n        success: true,\n        message: `Потребителят ${name} е обновен успешно`\n    };\n}\nasync function handleDeleteUser(db, command) {\n    const { name } = command;\n    if (!name) {\n        return {\n            success: false,\n            error: \"Името е задължително\"\n        };\n    }\n    // Find user by name (case insensitive)\n    const user = await db.get(\"SELECT * FROM users WHERE LOWER(name) = LOWER(?)\", [\n        name\n    ]);\n    if (!user) {\n        return {\n            success: false,\n            error: `Потребителят ${name} не е намерен`\n        };\n    }\n    // Check for future bookings\n    const futureBookings = await db.all('SELECT * FROM bookings WHERE phone = ? AND status IN (?, ?) AND date >= date(\"now\")', [\n        user.phone,\n        \"pending\",\n        \"confirmed\"\n    ]);\n    if (futureBookings.length > 0) {\n        return {\n            success: false,\n            error: `Не може да изтриете потребителят - има ${futureBookings.length} активни резервации`\n        };\n    }\n    // Check for historical data\n    const historicalData = await db.all(\"SELECT * FROM bookings WHERE phone = ?\", [\n        user.phone\n    ]);\n    if (historicalData.length > 0) {\n        return {\n            success: false,\n            error: `Потребителят има ${historicalData.length} исторически записи. Изисква се повторно потвърждение.`\n        };\n    }\n    await db.run(\"DELETE FROM users WHERE id = ?\", [\n        user.id\n    ]);\n    return {\n        success: true,\n        message: `Потребителят ${name} е изтрит успешно`\n    };\n}\nasync function handleAddBooking(db, command) {\n    const { name, date, time, service } = command;\n    if (!name || !date || !time) {\n        return {\n            success: false,\n            error: \"Името, датата и часът са задължителни\"\n        };\n    }\n    // Find or create user\n    let user = await db.get(\"SELECT * FROM users WHERE LOWER(name) = LOWER(?)\", [\n        name\n    ]);\n    if (!user) {\n        // Create user with default phone\n        const timestamp = Date.now();\n        const defaultPhone = `0888${timestamp.toString().slice(-6)}`;\n        await db.run(\"INSERT INTO users (name, phone) VALUES (?, ?)\", [\n            capitalizeName(name),\n            defaultPhone\n        ]);\n        user = await db.get(\"SELECT * FROM users WHERE phone = ?\", [\n            defaultPhone\n        ]);\n    }\n    // Parse and format date\n    const formattedDate = parseDate(date);\n    if (!formattedDate) {\n        return {\n            success: false,\n            error: \"Невалидна дата\"\n        };\n    }\n    // Check if slot is available\n    const existingBooking = await db.get(\"SELECT * FROM bookings WHERE date = ? AND time = ? AND status != ?\", [\n        formattedDate,\n        time,\n        \"cancelled\"\n    ]);\n    if (existingBooking) {\n        return {\n            success: false,\n            error: `Слотът ${time} на ${formattedDate} вече е зает`\n        };\n    }\n    // Get service ID if service name provided\n    let serviceId = null;\n    if (service) {\n        const serviceRecord = await db.get(\"SELECT id FROM services WHERE LOWER(name) = LOWER(?)\", [\n            service\n        ]);\n        serviceId = serviceRecord?.id || null;\n    }\n    await db.run(\"INSERT INTO bookings (name, phone, date, time, service_id, status) VALUES (?, ?, ?, ?, ?, ?)\", [\n        user.name,\n        user.phone,\n        formattedDate,\n        time,\n        serviceId,\n        \"pending\"\n    ]);\n    return {\n        success: true,\n        message: `Резервацията за ${user.name} на ${formattedDate} в ${time} е създадена успешно`\n    };\n}\nasync function handleUpdateBooking(db, command) {\n    const { name, date, time } = command;\n    if (!name || !date) {\n        return {\n            success: false,\n            error: \"Името и датата са задължителни\"\n        };\n    }\n    const formattedDate = parseDate(date);\n    if (!formattedDate) {\n        return {\n            success: false,\n            error: \"Невалидна дата\"\n        };\n    }\n    // Find booking\n    const booking = await db.get(\"SELECT * FROM bookings WHERE LOWER(name) = LOWER(?) AND date = ?\", [\n        name,\n        formattedDate\n    ]);\n    if (!booking) {\n        return {\n            success: false,\n            error: `Резервация за ${name} на ${formattedDate} не е намерена`\n        };\n    }\n    const updateFields = [];\n    const updateValues = [];\n    if (time) {\n        // Check if new time is available\n        const existingBooking = await db.get(\"SELECT * FROM bookings WHERE date = ? AND time = ? AND id != ? AND status != ?\", [\n            formattedDate,\n            time,\n            booking.id,\n            \"cancelled\"\n        ]);\n        if (existingBooking) {\n            return {\n                success: false,\n                error: `Слотът ${time} на ${formattedDate} вече е зает`\n            };\n        }\n        updateFields.push(\"time = ?\");\n        updateValues.push(time);\n    }\n    if (updateFields.length === 0) {\n        return {\n            success: false,\n            error: \"Не са посочени данни за промяна\"\n        };\n    }\n    updateValues.push(booking.id);\n    await db.run(`UPDATE bookings SET ${updateFields.join(\", \")} WHERE id = ?`, updateValues);\n    return {\n        success: true,\n        message: `Резервацията за ${name} е обновена успешно`\n    };\n}\nasync function handleCancelBooking(db, command) {\n    const { name, date } = command;\n    if (!name || !date) {\n        return {\n            success: false,\n            error: \"Името и датата са задължителни\"\n        };\n    }\n    const formattedDate = parseDate(date);\n    if (!formattedDate) {\n        return {\n            success: false,\n            error: \"Невалидна дата\"\n        };\n    }\n    const booking = await db.get(\"SELECT * FROM bookings WHERE LOWER(name) = LOWER(?) AND date = ?\", [\n        name,\n        formattedDate\n    ]);\n    if (!booking) {\n        return {\n            success: false,\n            error: `Резервация за ${name} на ${formattedDate} не е намерена`\n        };\n    }\n    await db.run(\"UPDATE bookings SET status = ? WHERE id = ?\", [\n        \"cancelled\",\n        booking.id\n    ]);\n    return {\n        success: true,\n        message: `Резервацията за ${name} на ${formattedDate} е отменена успешно`\n    };\n}\nasync function handleCheckAvailability(db, command) {\n    const { date } = command;\n    let targetDate = date ? parseDate(date) : new Date().toISOString().split(\"T\")[0];\n    if (!targetDate) {\n        targetDate = new Date().toISOString().split(\"T\")[0];\n    }\n    // Get all bookings for the date\n    const bookings = await db.all(\"SELECT time FROM bookings WHERE date = ? AND status != ?\", [\n        targetDate,\n        \"cancelled\"\n    ]);\n    const bookedTimes = bookings.map((b)=>b.time);\n    // Available time slots (9:00 - 17:00)\n    const allSlots = [];\n    for(let hour = 9; hour <= 17; hour++){\n        allSlots.push(`${hour.toString().padStart(2, \"0\")}:00`);\n    }\n    const availableSlots = allSlots.filter((slot)=>!bookedTimes.includes(slot));\n    return {\n        success: true,\n        message: `Намерени ${availableSlots.length} свободни слотове за ${targetDate}`,\n        result: {\n            availableSlots,\n            targetDate\n        }\n    };\n}\nasync function handleShowBookings(db, command) {\n    const { date } = command;\n    if (!date) {\n        return {\n            success: false,\n            error: \"Датата е задължителна\"\n        };\n    }\n    const formattedDate = parseDate(date);\n    if (!formattedDate) {\n        return {\n            success: false,\n            error: \"Невалидна дата\"\n        };\n    }\n    const bookings = await db.all(\"SELECT * FROM bookings WHERE date = ? ORDER BY time\", [\n        formattedDate\n    ]);\n    return {\n        success: true,\n        message: `Намерени ${bookings.length} резервации за ${formattedDate}`,\n        result: {\n            bookings,\n            date: formattedDate\n        }\n    };\n}\n// Helper functions\nfunction formatPhoneNumber(phone) {\n    // Remove all non-digits\n    const digits = phone.replace(/\\D/g, \"\");\n    // Handle 9-digit numbers (add +359)\n    if (digits.length === 9 && digits.startsWith(\"8\")) {\n        return `+359${digits.slice(1)}`;\n    }\n    // Handle 10-digit numbers (add +359)\n    if (digits.length === 10 && digits.startsWith(\"08\")) {\n        return `+359${digits.slice(1)}`;\n    }\n    // Handle 12-digit numbers (already formatted)\n    if (digits.length === 12 && digits.startsWith(\"359\")) {\n        return `+${digits}`;\n    }\n    // Default: assume it's a valid number\n    return digits.startsWith(\"+\") ? digits : `+359${digits}`;\n}\nfunction capitalizeName(name) {\n    return name.split(\" \").map((word)=>word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(\" \");\n}\nfunction parseDate(dateStr) {\n    // Handle various date formats\n    const today = new Date();\n    if (dateStr.toLowerCase() === \"днес\" || dateStr.toLowerCase() === \"сега\") {\n        return today.toISOString().split(\"T\")[0];\n    }\n    if (dateStr.toLowerCase() === \"утре\") {\n        const tomorrow = new Date(today);\n        tomorrow.setDate(tomorrow.getDate() + 1);\n        return tomorrow.toISOString().split(\"T\")[0];\n    }\n    // Try to parse DD.MM.YYYY format\n    const match = dateStr.match(/(\\d{1,2})[.\\-\\/](\\d{1,2})[.\\-\\/](\\d{4})/);\n    if (match) {\n        const [, day, month, year] = match;\n        return `${year}-${month.padStart(2, \"0\")}-${day.padStart(2, \"0\")}`;\n    }\n    // Try to parse YYYY-MM-DD format\n    if (dateStr.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n        return dateStr;\n    }\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hZG1pbi92b2ljZS1jb21tYW5kcy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLHFEQUFxRCxHQUNFO0FBQzFCO0FBQ0E7QUFjdEIsZUFBZUcsS0FBS0MsT0FBb0I7SUFDN0MsSUFBSTtRQUNGLE1BQU1DLE9BQU8sTUFBTUQsUUFBUUUsSUFBSTtRQUMvQixNQUFNQyxVQUF5QkY7UUFFL0JHLFFBQVFDLEdBQUcsQ0FBQywyQkFBMkJGO1FBRXZDLElBQUksQ0FBQ0EsUUFBUUcsTUFBTSxFQUFFO1lBQ25CLE9BQU9WLHFEQUFZQSxDQUFDTSxJQUFJLENBQUM7Z0JBQ3ZCSyxTQUFTO2dCQUNUQyxPQUFPO1lBQ1Q7UUFDRjtRQUVBLE1BQU1DLEtBQUssTUFBTVgsNENBQUlBLENBQUM7WUFDcEJZLFVBQVU7WUFDVkMsUUFBUWQseURBQWdCO1FBQzFCO1FBRUEsSUFBSWdCLFNBQWMsQ0FBQztRQUVuQixPQUFRVixRQUFRRyxNQUFNO1lBQ3BCLEtBQUs7Z0JBQ0hPLFNBQVMsTUFBTUMsY0FBY0wsSUFBSU47Z0JBQ2pDO1lBQ0YsS0FBSztnQkFDSFUsU0FBUyxNQUFNRSxpQkFBaUJOLElBQUlOO2dCQUNwQztZQUNGLEtBQUs7Z0JBQ0hVLFNBQVMsTUFBTUcsaUJBQWlCUCxJQUFJTjtnQkFDcEM7WUFDRixLQUFLO2dCQUNIVSxTQUFTLE1BQU1JLGlCQUFpQlIsSUFBSU47Z0JBQ3BDO1lBQ0YsS0FBSztnQkFDSFUsU0FBUyxNQUFNSyxvQkFBb0JULElBQUlOO2dCQUN2QztZQUNGLEtBQUs7Z0JBQ0hVLFNBQVMsTUFBTU0sb0JBQW9CVixJQUFJTjtnQkFDdkM7WUFDRixLQUFLO2dCQUNIVSxTQUFTLE1BQU1PLHdCQUF3QlgsSUFBSU47Z0JBQzNDO1lBQ0YsS0FBSztnQkFDSFUsU0FBUyxNQUFNUSxtQkFBbUJaLElBQUlOO2dCQUN0QztZQUNGO2dCQUNFLE9BQU9QLHFEQUFZQSxDQUFDTSxJQUFJLENBQUM7b0JBQ3ZCSyxTQUFT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LEVBQUVHLEtBQUssQ0FBQyxFQUFFRCxNQUFNbkIsUUFBUSxDQUFDLEdBQUcsS0FBSyxDQUFDLEVBQUVrQixJQUFJbEIsUUFBUSxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQ3BFO0lBRUEsaUNBQWlDO0lBQ2pDLElBQUlZLFFBQVFLLEtBQUssQ0FBQyx3QkFBd0I7UUFDeEMsT0FBT0w7SUFDVDtJQUVBLE9BQU87QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL2RyLWJvcmlzbGF2LXBldHJvdi13ZWJzaXRlLy4vc3JjL2FwcC9hcGkvYWRtaW4vdm9pY2UtY29tbWFuZHMvcm91dGUudHM/ZDlmZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgc3FsaXRlMyBmcm9tICdzcWxpdGUzJ1xuaW1wb3J0IHsgb3BlbiB9IGZyb20gJ3NxbGl0ZSdcblxuaW50ZXJmYWNlIFBhcnNlZENvbW1hbmQge1xuICBhY3Rpb246IHN0cmluZ1xuICBlbnRpdHk/OiBzdHJpbmdcbiAgbmFtZT86IHN0cmluZ1xuICBwaG9uZT86IHN0cmluZ1xuICBlbWFpbD86IHN0cmluZ1xuICBkYXRlPzogc3RyaW5nXG4gIHRpbWU/OiBzdHJpbmdcbiAgc2VydmljZT86IHN0cmluZ1xuICBvcmlnaW5hbENvbW1hbmQ6IHN0cmluZ1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgIGNvbnN0IGNvbW1hbmQ6IFBhcnNlZENvbW1hbmQgPSBib2R5XG5cbiAgICBjb25zb2xlLmxvZygnUmVjZWl2ZWQgdm9pY2UgY29tbWFuZDonLCBjb21tYW5kKVxuXG4gICAgaWYgKCFjb21tYW5kLmFjdGlvbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgZXJyb3I6ICfQndC10LLQsNC70LjQtNC90LAg0LrQvtC80LDQvdC00LAnIFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBkYiA9IGF3YWl0IG9wZW4oe1xuICAgICAgZmlsZW5hbWU6ICdib29raW5ncy5kYicsXG4gICAgICBkcml2ZXI6IHNxbGl0ZTMuRGF0YWJhc2VcbiAgICB9KVxuXG4gICAgbGV0IHJlc3VsdDogYW55ID0ge31cblxuICAgIHN3aXRjaCAoY29tbWFuZC5hY3Rpb24pIHtcbiAgICAgIGNhc2UgJ2FkZFVzZXInOlxuICAgICAgICByZXN1bHQgPSBhd2FpdCBoYW5kbGVBZGRVc2VyKGRiLCBjb21tYW5kKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAndXBkYXRlVXNlcic6XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IGhhbmRsZVVwZGF0ZVVzZXIoZGIsIGNvbW1hbmQpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdkZWxldGVVc2VyJzpcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgaGFuZGxlRGVsZXRlVXNlcihkYiwgY29tbWFuZClcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ2FkZEJvb2tpbmcnOlxuICAgICAgICByZXN1bHQgPSBhd2FpdCBoYW5kbGVBZGRCb29raW5nKGRiLCBjb21tYW5kKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAndXBkYXRlQm9va2luZyc6XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IGhhbmRsZVVwZGF0ZUJvb2tpbmcoZGIsIGNvbW1hbmQpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdjYW5jZWxCb29raW5nJzpcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgaGFuZGxlQ2FuY2VsQm9va2luZyhkYiwgY29tbWFuZClcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ2NoZWNrQXZhaWxhYmlsaXR5JzpcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgaGFuZGxlQ2hlY2tBdmFpbGFiaWxpdHkoZGIsIGNvbW1hbmQpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdzaG93Qm9va2luZ3MnOlxuICAgICAgICByZXN1bHQgPSBhd2FpdCBoYW5kbGVTaG93Qm9va2luZ3MoZGIsIGNvbW1hbmQpXG4gICAgICAgIGJyZWFrXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICAgICAgZXJyb3I6ICfQndC10YDQsNC30L/QvtC30L3QsNGC0LAg0LrQvtC80LDQvdC00LAnIFxuICAgICAgICB9KVxuICAgIH1cblxuICAgIGF3YWl0IGRiLmNsb3NlKClcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzdWx0KVxuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignVm9pY2UgY29tbWFuZCBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgIGVycm9yOiAn0JPRgNC10YjQutCwINC/0YDQuCDQvtCx0YDQsNCx0L7RgtC60LAg0L3QsCDQutC+0LzQsNC90LTQsNGC0LAnIFxuICAgIH0pXG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlQWRkVXNlcihkYjogYW55LCBjb21tYW5kOiBQYXJzZWRDb21tYW5kKSB7XG4gIGNvbnN0IHsgbmFtZSwgcGhvbmUsIGVtYWlsIH0gPSBjb21tYW5kXG5cbiAgaWYgKCFuYW1lKSB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAn0JjQvNC10YLQviDQtSDQt9Cw0LTRitC70LbQuNGC0LXQu9C90L4nIH1cbiAgfVxuXG4gIC8vIEdlbmVyYXRlIHVuaXF1ZSBwaG9uZSBpZiBub3QgcHJvdmlkZWRcbiAgbGV0IHVzZXJQaG9uZSA9IHBob25lXG4gIGlmICghdXNlclBob25lKSB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKVxuICAgIHVzZXJQaG9uZSA9IGAwODg4JHt0aW1lc3RhbXAudG9TdHJpbmcoKS5zbGljZSgtNil9YFxuICB9XG5cbiAgLy8gRm9ybWF0IHBob25lIG51bWJlclxuICB1c2VyUGhvbmUgPSBmb3JtYXRQaG9uZU51bWJlcih1c2VyUGhvbmUpXG5cbiAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0c1xuICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCBkYi5nZXQoXG4gICAgJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgcGhvbmUgPSA/JyxcbiAgICBbdXNlclBob25lXVxuICApXG5cbiAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgIHJldHVybiB7IFxuICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgZXJyb3I6IGDQn9C+0YLRgNC10LHQuNGC0LXQuyDRgSDRgtC10LvQtdGE0L7QvSAke3VzZXJQaG9uZX0g0LLQtdGH0LUg0YHRitGJ0LXRgdGC0LLRg9Cy0LBgIFxuICAgIH1cbiAgfVxuXG4gIC8vIENhcGl0YWxpemUgbmFtZVxuICBjb25zdCBjYXBpdGFsaXplZE5hbWUgPSBjYXBpdGFsaXplTmFtZShuYW1lKVxuXG4gIGF3YWl0IGRiLnJ1bihcbiAgICAnSU5TRVJUIElOVE8gdXNlcnMgKG5hbWUsIHBob25lLCBlbWFpbCkgVkFMVUVTICg/LCA/LCA/KScsXG4gICAgW2NhcGl0YWxpemVkTmFtZSwgdXNlclBob25lLCBlbWFpbCB8fCBudWxsXVxuICApXG5cbiAgcmV0dXJuIHsgXG4gICAgc3VjY2VzczogdHJ1ZSwgXG4gICAgbWVzc2FnZTogYNCf0L7RgtGA0LXQsdC40YLQtdC70Y/RgiAke2NhcGl0YWxpemVkTmFtZX0g0LUg0LTQvtCx0LDQstC10L0g0YPRgdC/0LXRiNC90L4g0YEg0YLQtdC70LXRhNC+0L0gJHt1c2VyUGhvbmV9YCBcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVVcGRhdGVVc2VyKGRiOiBhbnksIGNvbW1hbmQ6IFBhcnNlZENvbW1hbmQpIHtcbiAgY29uc3QgeyBuYW1lLCBwaG9uZSwgZW1haWwgfSA9IGNvbW1hbmRcblxuICBpZiAoIW5hbWUpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICfQmNC80LXRgtC+INC1INC30LDQtNGK0LvQttC40YLQtdC70L3QvicgfVxuICB9XG5cbiAgLy8gRmluZCB1c2VyIGJ5IG5hbWUgKGNhc2UgaW5zZW5zaXRpdmUpXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi5nZXQoXG4gICAgJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgTE9XRVIobmFtZSkgPSBMT1dFUig/KScsXG4gICAgW25hbWVdXG4gIClcblxuICBpZiAoIXVzZXIpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGDQn9C+0YLRgNC10LHQuNGC0LXQu9GP0YIgJHtuYW1lfSDQvdC1INC1INC90LDQvNC10YDQtdC9YCB9XG4gIH1cblxuICBjb25zdCB1cGRhdGVGaWVsZHMgPSBbXVxuICBjb25zdCB1cGRhdGVWYWx1ZXMgPSBbXVxuXG4gIGlmIChwaG9uZSkge1xuICAgIGNvbnN0IGZvcm1hdHRlZFBob25lID0gZm9ybWF0UGhvbmVOdW1iZXIocGhvbmUpXG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgbmV3IHBob25lIGFscmVhZHkgZXhpc3RzXG4gICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgZGIuZ2V0KFxuICAgICAgJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgcGhvbmUgPSA/IEFORCBpZCAhPSA/JyxcbiAgICAgIFtmb3JtYXR0ZWRQaG9uZSwgdXNlci5pZF1cbiAgICApXG5cbiAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICByZXR1cm4geyBcbiAgICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgICBlcnJvcjogYNCi0LXQu9C10YTQvtC9ICR7Zm9ybWF0dGVkUGhvbmV9INCy0LXRh9C1INGB0LUg0LjQt9C/0L7Qu9C30LLQsCDQvtGCINC00YDRg9CzINC/0L7RgtGA0LXQsdC40YLQtdC7YCBcbiAgICAgIH1cbiAgICB9XG5cbiAgICB1cGRhdGVGaWVsZHMucHVzaCgncGhvbmUgPSA/JylcbiAgICB1cGRhdGVWYWx1ZXMucHVzaChmb3JtYXR0ZWRQaG9uZSlcblxuICAgIC8vIE1pZ3JhdGUgYm9va2luZ3MgdG8gbmV3IHBob25lXG4gICAgYXdhaXQgZGIucnVuKFxuICAgICAgJ1VQREFURSBib29raW5ncyBTRVQgcGhvbmUgPSA/IFdIRVJFIHBob25lID0gPycsXG4gICAgICBbZm9ybWF0dGVkUGhvbmUsIHVzZXIucGhvbmVdXG4gICAgKVxuICB9XG5cbiAgaWYgKGVtYWlsKSB7XG4gICAgdXBkYXRlRmllbGRzLnB1c2goJ2VtYWlsID0gPycpXG4gICAgdXBkYXRlVmFsdWVzLnB1c2goZW1haWwpXG4gIH1cblxuICBpZiAodXBkYXRlRmllbGRzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ9Cd0LUg0YHQsCDQv9C+0YHQvtGH0LXQvdC4INC00LDQvdC90Lgg0LfQsCDQv9GA0L7QvNGP0L3QsCcgfVxuICB9XG5cbiAgdXBkYXRlVmFsdWVzLnB1c2godXNlci5pZClcbiAgYXdhaXQgZGIucnVuKFxuICAgIGBVUERBVEUgdXNlcnMgU0VUICR7dXBkYXRlRmllbGRzLmpvaW4oJywgJyl9IFdIRVJFIGlkID0gP2AsXG4gICAgdXBkYXRlVmFsdWVzXG4gIClcblxuICByZXR1cm4geyBcbiAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICBtZXNzYWdlOiBg0J/QvtGC0YDQtdCx0LjRgtC10LvRj9GCICR7bmFtZX0g0LUg0L7QsdC90L7QstC10L0g0YPRgdC/0LXRiNC90L5gIFxuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZURlbGV0ZVVzZXIoZGI6IGFueSwgY29tbWFuZDogUGFyc2VkQ29tbWFuZCkge1xuICBjb25zdCB7IG5hbWUgfSA9IGNvbW1hbmRcblxuICBpZiAoIW5hbWUpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICfQmNC80LXRgtC+INC1INC30LDQtNGK0LvQttC40YLQtdC70L3QvicgfVxuICB9XG5cbiAgLy8gRmluZCB1c2VyIGJ5IG5hbWUgKGNhc2UgaW5zZW5zaXRpdmUpXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi5nZXQoXG4gICAgJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgTE9XRVIobmFtZSkgPSBMT1dFUig/KScsXG4gICAgW25hbWVdXG4gIClcblxuICBpZiAoIXVzZXIpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGDQn9C+0YLRgNC10LHQuNGC0LXQu9GP0YIgJHtuYW1lfSDQvdC1INC1INC90LDQvNC10YDQtdC9YCB9XG4gIH1cblxuICAvLyBDaGVjayBmb3IgZnV0dXJlIGJvb2tpbmdzXG4gIGNvbnN0IGZ1dHVyZUJvb2tpbmdzID0gYXdhaXQgZGIuYWxsKFxuICAgICdTRUxFQ1QgKiBGUk9NIGJvb2tpbmdzIFdIRVJFIHBob25lID0gPyBBTkQgc3RhdHVzIElOICg/LCA/KSBBTkQgZGF0ZSA+PSBkYXRlKFwibm93XCIpJyxcbiAgICBbdXNlci5waG9uZSwgJ3BlbmRpbmcnLCAnY29uZmlybWVkJ11cbiAgKVxuXG4gIGlmIChmdXR1cmVCb29raW5ncy5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICBlcnJvcjogYNCd0LUg0LzQvtC20LUg0LTQsCDQuNC30YLRgNC40LXRgtC1INC/0L7RgtGA0LXQsdC40YLQtdC70Y/RgiAtINC40LzQsCAke2Z1dHVyZUJvb2tpbmdzLmxlbmd0aH0g0LDQutGC0LjQstC90Lgg0YDQtdC30LXRgNCy0LDRhtC40LhgIFxuICAgIH1cbiAgfVxuXG4gIC8vIENoZWNrIGZvciBoaXN0b3JpY2FsIGRhdGFcbiAgY29uc3QgaGlzdG9yaWNhbERhdGEgPSBhd2FpdCBkYi5hbGwoXG4gICAgJ1NFTEVDVCAqIEZST00gYm9va2luZ3MgV0hFUkUgcGhvbmUgPSA/JyxcbiAgICBbdXNlci5waG9uZV1cbiAgKVxuXG4gIGlmIChoaXN0b3JpY2FsRGF0YS5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICBlcnJvcjogYNCf0L7RgtGA0LXQsdC40YLQtdC70Y/RgiDQuNC80LAgJHtoaXN0b3JpY2FsRGF0YS5sZW5ndGh9INC40YHRgtC+0YDQuNGH0LXRgdC60Lgg0LfQsNC/0LjRgdC4LiDQmNC30LjRgdC60LLQsCDRgdC1INC/0L7QstGC0L7RgNC90L4g0L/QvtGC0LLRitGA0LbQtNC10L3QuNC1LmAgXG4gICAgfVxuICB9XG5cbiAgYXdhaXQgZGIucnVuKCdERUxFVEUgRlJPTSB1c2VycyBXSEVSRSBpZCA9ID8nLCBbdXNlci5pZF0pXG5cbiAgcmV0dXJuIHsgXG4gICAgc3VjY2VzczogdHJ1ZSwgXG4gICAgbWVzc2FnZTogYNCf0L7RgtGA0LXQsdC40YLQtdC70Y/RgiAke25hbWV9INC1INC40LfRgtGA0LjRgiDRg9GB0L/QtdGI0L3QvmAgXG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlQWRkQm9va2luZyhkYjogYW55LCBjb21tYW5kOiBQYXJzZWRDb21tYW5kKSB7XG4gIGNvbnN0IHsgbmFtZSwgZGF0ZSwgdGltZSwgc2VydmljZSB9ID0gY29tbWFuZFxuXG4gIGlmICghbmFtZSB8fCAhZGF0ZSB8fCAhdGltZSkge1xuICAgIHJldHVybiB7IFxuICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgZXJyb3I6ICfQmNC80LXRgtC+LCDQtNCw0YLQsNGC0LAg0Lgg0YfQsNGB0YrRgiDRgdCwINC30LDQtNGK0LvQttC40YLQtdC70L3QuCcgXG4gICAgfVxuICB9XG5cbiAgLy8gRmluZCBvciBjcmVhdGUgdXNlclxuICBsZXQgdXNlciA9IGF3YWl0IGRiLmdldChcbiAgICAnU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBMT1dFUihuYW1lKSA9IExPV0VSKD8pJyxcbiAgICBbbmFtZV1cbiAgKVxuXG4gIGlmICghdXNlcikge1xuICAgIC8vIENyZWF0ZSB1c2VyIHdpdGggZGVmYXVsdCBwaG9uZVxuICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KClcbiAgICBjb25zdCBkZWZhdWx0UGhvbmUgPSBgMDg4OCR7dGltZXN0YW1wLnRvU3RyaW5nKCkuc2xpY2UoLTYpfWBcbiAgICBcbiAgICBhd2FpdCBkYi5ydW4oXG4gICAgICAnSU5TRVJUIElOVE8gdXNlcnMgKG5hbWUsIHBob25lKSBWQUxVRVMgKD8sID8pJyxcbiAgICAgIFtjYXBpdGFsaXplTmFtZShuYW1lKSwgZGVmYXVsdFBob25lXVxuICAgIClcbiAgICBcbiAgICB1c2VyID0gYXdhaXQgZGIuZ2V0KFxuICAgICAgJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgcGhvbmUgPSA/JyxcbiAgICAgIFtkZWZhdWx0UGhvbmVdXG4gICAgKVxuICB9XG5cbiAgLy8gUGFyc2UgYW5kIGZvcm1hdCBkYXRlXG4gIGNvbnN0IGZvcm1hdHRlZERhdGUgPSBwYXJzZURhdGUoZGF0ZSlcbiAgaWYgKCFmb3JtYXR0ZWREYXRlKSB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAn0J3QtdCy0LDQu9C40LTQvdCwINC00LDRgtCwJyB9XG4gIH1cblxuICAvLyBDaGVjayBpZiBzbG90IGlzIGF2YWlsYWJsZVxuICBjb25zdCBleGlzdGluZ0Jvb2tpbmcgPSBhd2FpdCBkYi5nZXQoXG4gICAgJ1NFTEVDVCAqIEZST00gYm9va2luZ3MgV0hFUkUgZGF0ZSA9ID8gQU5EIHRpbWUgPSA/IEFORCBzdGF0dXMgIT0gPycsXG4gICAgW2Zvcm1hdHRlZERhdGUsIHRpbWUsICdjYW5jZWxsZWQnXVxuICApXG5cbiAgaWYgKGV4aXN0aW5nQm9va2luZykge1xuICAgIHJldHVybiB7IFxuICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgZXJyb3I6IGDQodC70L7RgtGK0YIgJHt0aW1lfSDQvdCwICR7Zm9ybWF0dGVkRGF0ZX0g0LLQtdGH0LUg0LUg0LfQsNC10YJgIFxuICAgIH1cbiAgfVxuXG4gIC8vIEdldCBzZXJ2aWNlIElEIGlmIHNlcnZpY2UgbmFtZSBwcm92aWRlZFxuICBsZXQgc2VydmljZUlkID0gbnVsbFxuICBpZiAoc2VydmljZSkge1xuICAgIGNvbnN0IHNlcnZpY2VSZWNvcmQgPSBhd2FpdCBkYi5nZXQoXG4gICAgICAnU0VMRUNUIGlkIEZST00gc2VydmljZXMgV0hFUkUgTE9XRVIobmFtZSkgPSBMT1dFUig/KScsXG4gICAgICBbc2VydmljZV1cbiAgICApXG4gICAgc2VydmljZUlkID0gc2VydmljZVJlY29yZD8uaWQgfHwgbnVsbFxuICB9XG5cbiAgYXdhaXQgZGIucnVuKFxuICAgICdJTlNFUlQgSU5UTyBib29raW5ncyAobmFtZSwgcGhvbmUsIGRhdGUsIHRpbWUsIHNlcnZpY2VfaWQsIHN0YXR1cykgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/KScsXG4gICAgW3VzZXIubmFtZSwgdXNlci5waG9uZSwgZm9ybWF0dGVkRGF0ZSwgdGltZSwgc2VydmljZUlkLCAncGVuZGluZyddXG4gIClcblxuICByZXR1cm4geyBcbiAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICBtZXNzYWdlOiBg0KDQtdC30LXRgNCy0LDRhtC40Y/RgtCwINC30LAgJHt1c2VyLm5hbWV9INC90LAgJHtmb3JtYXR0ZWREYXRlfSDQsiAke3RpbWV9INC1INGB0YrQt9C00LDQtNC10L3QsCDRg9GB0L/QtdGI0L3QvmAgXG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlVXBkYXRlQm9va2luZyhkYjogYW55LCBjb21tYW5kOiBQYXJzZWRDb21tYW5kKSB7XG4gIGNvbnN0IHsgbmFtZSwgZGF0ZSwgdGltZSB9ID0gY29tbWFuZFxuXG4gIGlmICghbmFtZSB8fCAhZGF0ZSkge1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ9CY0LzQtdGC0L4g0Lgg0LTQsNGC0LDRgtCwINGB0LAg0LfQsNC00YrQu9C20LjRgtC10LvQvdC4JyB9XG4gIH1cblxuICBjb25zdCBmb3JtYXR0ZWREYXRlID0gcGFyc2VEYXRlKGRhdGUpXG4gIGlmICghZm9ybWF0dGVkRGF0ZSkge1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ9Cd0LXQstCw0LvQuNC00L3QsCDQtNCw0YLQsCcgfVxuICB9XG5cbiAgLy8gRmluZCBib29raW5nXG4gIGNvbnN0IGJvb2tpbmcgPSBhd2FpdCBkYi5nZXQoXG4gICAgJ1NFTEVDVCAqIEZST00gYm9va2luZ3MgV0hFUkUgTE9XRVIobmFtZSkgPSBMT1dFUig/KSBBTkQgZGF0ZSA9ID8nLFxuICAgIFtuYW1lLCBmb3JtYXR0ZWREYXRlXVxuICApXG5cbiAgaWYgKCFib29raW5nKSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICBlcnJvcjogYNCg0LXQt9C10YDQstCw0YbQuNGPINC30LAgJHtuYW1lfSDQvdCwICR7Zm9ybWF0dGVkRGF0ZX0g0L3QtSDQtSDQvdCw0LzQtdGA0LXQvdCwYCBcbiAgICB9XG4gIH1cblxuICBjb25zdCB1cGRhdGVGaWVsZHMgPSBbXVxuICBjb25zdCB1cGRhdGVWYWx1ZXMgPSBbXVxuXG4gIGlmICh0aW1lKSB7XG4gICAgLy8gQ2hlY2sgaWYgbmV3IHRpbWUgaXMgYXZhaWxhYmxlXG4gICAgY29uc3QgZXhpc3RpbmdCb29raW5nID0gYXdhaXQgZGIuZ2V0KFxuICAgICAgJ1NFTEVDVCAqIEZST00gYm9va2luZ3MgV0hFUkUgZGF0ZSA9ID8gQU5EIHRpbWUgPSA/IEFORCBpZCAhPSA/IEFORCBzdGF0dXMgIT0gPycsXG4gICAgICBbZm9ybWF0dGVkRGF0ZSwgdGltZSwgYm9va2luZy5pZCwgJ2NhbmNlbGxlZCddXG4gICAgKVxuXG4gICAgaWYgKGV4aXN0aW5nQm9va2luZykge1xuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgZXJyb3I6IGDQodC70L7RgtGK0YIgJHt0aW1lfSDQvdCwICR7Zm9ybWF0dGVkRGF0ZX0g0LLQtdGH0LUg0LUg0LfQsNC10YJgIFxuICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZUZpZWxkcy5wdXNoKCd0aW1lID0gPycpXG4gICAgdXBkYXRlVmFsdWVzLnB1c2godGltZSlcbiAgfVxuXG4gIGlmICh1cGRhdGVGaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAn0J3QtSDRgdCwINC/0L7RgdC+0YfQtdC90Lgg0LTQsNC90L3QuCDQt9CwINC/0YDQvtC80Y/QvdCwJyB9XG4gIH1cblxuICB1cGRhdGVWYWx1ZXMucHVzaChib29raW5nLmlkKVxuICBhd2FpdCBkYi5ydW4oXG4gICAgYFVQREFURSBib29raW5ncyBTRVQgJHt1cGRhdGVGaWVsZHMuam9pbignLCAnKX0gV0hFUkUgaWQgPSA/YCxcbiAgICB1cGRhdGVWYWx1ZXNcbiAgKVxuXG4gIHJldHVybiB7IFxuICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgIG1lc3NhZ2U6IGDQoNC10LfQtdGA0LLQsNGG0LjRj9GC0LAg0LfQsCAke25hbWV9INC1INC+0LHQvdC+0LLQtdC90LAg0YPRgdC/0LXRiNC90L5gIFxuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNhbmNlbEJvb2tpbmcoZGI6IGFueSwgY29tbWFuZDogUGFyc2VkQ29tbWFuZCkge1xuICBjb25zdCB7IG5hbWUsIGRhdGUgfSA9IGNvbW1hbmRcblxuICBpZiAoIW5hbWUgfHwgIWRhdGUpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICfQmNC80LXRgtC+INC4INC00LDRgtCw0YLQsCDRgdCwINC30LDQtNGK0LvQttC40YLQtdC70L3QuCcgfVxuICB9XG5cbiAgY29uc3QgZm9ybWF0dGVkRGF0ZSA9IHBhcnNlRGF0ZShkYXRlKVxuICBpZiAoIWZvcm1hdHRlZERhdGUpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICfQndC10LLQsNC70LjQtNC90LAg0LTQsNGC0LAnIH1cbiAgfVxuXG4gIGNvbnN0IGJvb2tpbmcgPSBhd2FpdCBkYi5nZXQoXG4gICAgJ1NFTEVDVCAqIEZST00gYm9va2luZ3MgV0hFUkUgTE9XRVIobmFtZSkgPSBMT1dFUig/KSBBTkQgZGF0ZSA9ID8nLFxuICAgIFtuYW1lLCBmb3JtYXR0ZWREYXRlXVxuICApXG5cbiAgaWYgKCFib29raW5nKSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICBlcnJvcjogYNCg0LXQt9C10YDQstCw0YbQuNGPINC30LAgJHtuYW1lfSDQvdCwICR7Zm9ybWF0dGVkRGF0ZX0g0L3QtSDQtSDQvdCw0LzQtdGA0LXQvdCwYCBcbiAgICB9XG4gIH1cblxuICBhd2FpdCBkYi5ydW4oXG4gICAgJ1VQREFURSBib29raW5ncyBTRVQgc3RhdHVzID0gPyBXSEVSRSBpZCA9ID8nLFxuICAgIFsnY2FuY2VsbGVkJywgYm9va2luZy5pZF1cbiAgKVxuXG4gIHJldHVybiB7IFxuICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgIG1lc3NhZ2U6IGDQoNC10LfQtdGA0LLQsNGG0LjRj9GC0LAg0LfQsCAke25hbWV9INC90LAgJHtmb3JtYXR0ZWREYXRlfSDQtSDQvtGC0LzQtdC90LXQvdCwINGD0YHQv9C10YjQvdC+YCBcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVDaGVja0F2YWlsYWJpbGl0eShkYjogYW55LCBjb21tYW5kOiBQYXJzZWRDb21tYW5kKSB7XG4gIGNvbnN0IHsgZGF0ZSB9ID0gY29tbWFuZFxuICBcbiAgbGV0IHRhcmdldERhdGUgPSBkYXRlID8gcGFyc2VEYXRlKGRhdGUpIDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF1cbiAgXG4gIGlmICghdGFyZ2V0RGF0ZSkge1xuICAgIHRhcmdldERhdGUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXVxuICB9XG5cbiAgLy8gR2V0IGFsbCBib29raW5ncyBmb3IgdGhlIGRhdGVcbiAgY29uc3QgYm9va2luZ3MgPSBhd2FpdCBkYi5hbGwoXG4gICAgJ1NFTEVDVCB0aW1lIEZST00gYm9va2luZ3MgV0hFUkUgZGF0ZSA9ID8gQU5EIHN0YXR1cyAhPSA/JyxcbiAgICBbdGFyZ2V0RGF0ZSwgJ2NhbmNlbGxlZCddXG4gIClcblxuICBjb25zdCBib29rZWRUaW1lcyA9IGJvb2tpbmdzLm1hcCgoYjogYW55KSA9PiBiLnRpbWUpXG4gIFxuICAvLyBBdmFpbGFibGUgdGltZSBzbG90cyAoOTowMCAtIDE3OjAwKVxuICBjb25zdCBhbGxTbG90cyA9IFtdXG4gIGZvciAobGV0IGhvdXIgPSA5OyBob3VyIDw9IDE3OyBob3VyKyspIHtcbiAgICBhbGxTbG90cy5wdXNoKGAke2hvdXIudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfTowMGApXG4gIH1cblxuICBjb25zdCBhdmFpbGFibGVTbG90cyA9IGFsbFNsb3RzLmZpbHRlcihzbG90ID0+ICFib29rZWRUaW1lcy5pbmNsdWRlcyhzbG90KSlcblxuICByZXR1cm4ge1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgbWVzc2FnZTogYNCd0LDQvNC10YDQtdC90LggJHthdmFpbGFibGVTbG90cy5sZW5ndGh9INGB0LLQvtCx0L7QtNC90Lgg0YHQu9C+0YLQvtCy0LUg0LfQsCAke3RhcmdldERhdGV9YCxcbiAgICByZXN1bHQ6IHtcbiAgICAgIGF2YWlsYWJsZVNsb3RzLFxuICAgICAgdGFyZ2V0RGF0ZVxuICAgIH1cbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVTaG93Qm9va2luZ3MoZGI6IGFueSwgY29tbWFuZDogUGFyc2VkQ29tbWFuZCkge1xuICBjb25zdCB7IGRhdGUgfSA9IGNvbW1hbmRcbiAgXG4gIGlmICghZGF0ZSkge1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ9CU0LDRgtCw0YLQsCDQtSDQt9Cw0LTRitC70LbQuNGC0LXQu9C90LAnIH1cbiAgfVxuXG4gIGNvbnN0IGZvcm1hdHRlZERhdGUgPSBwYXJzZURhdGUoZGF0ZSlcbiAgaWYgKCFmb3JtYXR0ZWREYXRlKSB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAn0J3QtdCy0LDQu9C40LTQvdCwINC00LDRgtCwJyB9XG4gIH1cblxuICBjb25zdCBib29raW5ncyA9IGF3YWl0IGRiLmFsbChcbiAgICAnU0VMRUNUICogRlJPTSBib29raW5ncyBXSEVSRSBkYXRlID0gPyBPUkRFUiBCWSB0aW1lJyxcbiAgICBbZm9ybWF0dGVkRGF0ZV1cbiAgKVxuXG4gIHJldHVybiB7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICBtZXNzYWdlOiBg0J3QsNC80LXRgNC10L3QuCAke2Jvb2tpbmdzLmxlbmd0aH0g0YDQtdC30LXRgNCy0LDRhtC40Lgg0LfQsCAke2Zvcm1hdHRlZERhdGV9YCxcbiAgICByZXN1bHQ6IHtcbiAgICAgIGJvb2tpbmdzLFxuICAgICAgZGF0ZTogZm9ybWF0dGVkRGF0ZVxuICAgIH1cbiAgfVxufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb25zXG5mdW5jdGlvbiBmb3JtYXRQaG9uZU51bWJlcihwaG9uZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gUmVtb3ZlIGFsbCBub24tZGlnaXRzXG4gIGNvbnN0IGRpZ2l0cyA9IHBob25lLnJlcGxhY2UoL1xcRC9nLCAnJylcbiAgXG4gIC8vIEhhbmRsZSA5LWRpZ2l0IG51bWJlcnMgKGFkZCArMzU5KVxuICBpZiAoZGlnaXRzLmxlbmd0aCA9PT0gOSAmJiBkaWdpdHMuc3RhcnRzV2l0aCgnOCcpKSB7XG4gICAgcmV0dXJuIGArMzU5JHtkaWdpdHMuc2xpY2UoMSl9YFxuICB9XG4gIFxuICAvLyBIYW5kbGUgMTAtZGlnaXQgbnVtYmVycyAoYWRkICszNTkpXG4gIGlmIChkaWdpdHMubGVuZ3RoID09PSAxMCAmJiBkaWdpdHMuc3RhcnRzV2l0aCgnMDgnKSkge1xuICAgIHJldHVybiBgKzM1OSR7ZGlnaXRzLnNsaWNlKDEpfWBcbiAgfVxuICBcbiAgLy8gSGFuZGxlIDEyLWRpZ2l0IG51bWJlcnMgKGFscmVhZHkgZm9ybWF0dGVkKVxuICBpZiAoZGlnaXRzLmxlbmd0aCA9PT0gMTIgJiYgZGlnaXRzLnN0YXJ0c1dpdGgoJzM1OScpKSB7XG4gICAgcmV0dXJuIGArJHtkaWdpdHN9YFxuICB9XG4gIFxuICAvLyBEZWZhdWx0OiBhc3N1bWUgaXQncyBhIHZhbGlkIG51bWJlclxuICByZXR1cm4gZGlnaXRzLnN0YXJ0c1dpdGgoJysnKSA/IGRpZ2l0cyA6IGArMzU5JHtkaWdpdHN9YFxufVxuXG5mdW5jdGlvbiBjYXBpdGFsaXplTmFtZShuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gbmFtZVxuICAgIC5zcGxpdCgnICcpXG4gICAgLm1hcCh3b3JkID0+IHdvcmQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpLnRvTG93ZXJDYXNlKCkpXG4gICAgLmpvaW4oJyAnKVxufVxuXG5mdW5jdGlvbiBwYXJzZURhdGUoZGF0ZVN0cjogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gIC8vIEhhbmRsZSB2YXJpb3VzIGRhdGUgZm9ybWF0c1xuICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKClcbiAgXG4gIGlmIChkYXRlU3RyLnRvTG93ZXJDYXNlKCkgPT09ICfQtNC90LXRgScgfHwgZGF0ZVN0ci50b0xvd2VyQ2FzZSgpID09PSAn0YHQtdCz0LAnKSB7XG4gICAgcmV0dXJuIHRvZGF5LnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXVxuICB9XG4gIFxuICBpZiAoZGF0ZVN0ci50b0xvd2VyQ2FzZSgpID09PSAn0YPRgtGA0LUnKSB7XG4gICAgY29uc3QgdG9tb3Jyb3cgPSBuZXcgRGF0ZSh0b2RheSlcbiAgICB0b21vcnJvdy5zZXREYXRlKHRvbW9ycm93LmdldERhdGUoKSArIDEpXG4gICAgcmV0dXJuIHRvbW9ycm93LnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXVxuICB9XG4gIFxuICAvLyBUcnkgdG8gcGFyc2UgREQuTU0uWVlZWSBmb3JtYXRcbiAgY29uc3QgbWF0Y2ggPSBkYXRlU3RyLm1hdGNoKC8oXFxkezEsMn0pWy5cXC1cXC9dKFxcZHsxLDJ9KVsuXFwtXFwvXShcXGR7NH0pLylcbiAgaWYgKG1hdGNoKSB7XG4gICAgY29uc3QgWywgZGF5LCBtb250aCwgeWVhcl0gPSBtYXRjaFxuICAgIHJldHVybiBgJHt5ZWFyfS0ke21vbnRoLnBhZFN0YXJ0KDIsICcwJyl9LSR7ZGF5LnBhZFN0YXJ0KDIsICcwJyl9YFxuICB9XG4gIFxuICAvLyBUcnkgdG8gcGFyc2UgWVlZWS1NTS1ERCBmb3JtYXRcbiAgaWYgKGRhdGVTdHIubWF0Y2goL15cXGR7NH0tXFxkezJ9LVxcZHsyfSQvKSkge1xuICAgIHJldHVybiBkYXRlU3RyXG4gIH1cbiAgXG4gIHJldHVybiBudWxsXG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInNxbGl0ZTMiLCJvcGVuIiwiUE9TVCIsInJlcXVlc3QiLCJib2R5IiwianNvbiIsImNvbW1hbmQiLCJjb25zb2xlIiwibG9nIiwiYWN0aW9uIiwic3VjY2VzcyIsImVycm9yIiwiZGIiLCJmaWxlbmFtZSIsImRyaXZlciIsIkRhdGFiYXNlIiwicmVzdWx0IiwiaGFuZGxlQWRkVXNlciIsImhhbmRsZVVwZGF0ZVVzZXIiLCJoYW5kbGVEZWxldGVVc2VyIiwiaGFuZGxlQWRkQm9va2luZyIsImhhbmRsZVVwZGF0ZUJvb2tpbmciLCJoYW5kbGVDYW5jZWxCb29raW5nIiwiaGFuZGxlQ2hlY2tBdmFpbGFiaWxpdHkiLCJoYW5kbGVTaG93Qm9va2luZ3MiLCJjbG9zZSIsIm5hbWUiLCJwaG9uZSIsImVtYWlsIiwidXNlclBob25lIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsInRvU3RyaW5nIiwic2xpY2UiLCJmb3JtYXRQaG9uZU51bWJlciIsImV4aXN0aW5nVXNlciIsImdldCIsImNhcGl0YWxpemVkTmFtZSIsImNhcGl0YWxpemVOYW1lIiwicnVuIiwibWVzc2FnZSIsInVzZXIiLCJ1cGRhdGVGaWVsZHMiLCJ1cGRhdGVWYWx1ZXMiLCJmb3JtYXR0ZWRQaG9uZSIsImlkIiwicHVzaCIsImxlbmd0aCIsImpvaW4iLCJmdXR1cmVCb29raW5ncyIsImFsbCIsImhpc3RvcmljYWxEYXRhIiwiZGF0ZSIsInRpbWUiLCJzZXJ2aWNlIiwiZGVmYXVsdFBob25lIiwiZm9ybWF0dGVkRGF0ZSIsInBhcnNlRGF0ZSIsImV4aXN0aW5nQm9va2luZyIsInNlcnZpY2VJZCIsInNlcnZpY2VSZWNvcmQiLCJib29raW5nIiwidGFyZ2V0RGF0ZSIsInRvSVNPU3RyaW5nIiwic3BsaXQiLCJib29raW5ncyIsImJvb2tlZFRpbWVzIiwibWFwIiwiYiIsImFsbFNsb3RzIiwiaG91ciIsInBhZFN0YXJ0IiwiYXZhaWxhYmxlU2xvdHMiLCJmaWx0ZXIiLCJzbG90IiwiaW5jbHVkZXMiLCJkaWdpdHMiLCJyZXBsYWNlIiwic3RhcnRzV2l0aCIsIndvcmQiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInRvTG93ZXJDYXNlIiwiZGF0ZVN0ciIsInRvZGF5IiwidG9tb3Jyb3ciLCJzZXREYXRlIiwiZ2V0RGF0ZSIsIm1hdGNoIiwiZGF5IiwibW9udGgiLCJ5ZWFyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/admin/voice-commands/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/sqlite"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fvoice-commands%2Froute&page=%2Fapi%2Fadmin%2Fvoice-commands%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fvoice-commands%2Froute.ts&appDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();