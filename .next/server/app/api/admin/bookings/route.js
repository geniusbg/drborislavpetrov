"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/admin/bookings/route";
exports.ids = ["app/api/admin/bookings/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = import("pg");;

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fbookings%2Froute&page=%2Fapi%2Fadmin%2Fbookings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fbookings%2Froute.ts&appDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fbookings%2Froute&page=%2Fapi%2Fadmin%2Fbookings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fbookings%2Froute.ts&appDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_genius_Downloads_drborislavpetrov_src_app_api_admin_bookings_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/admin/bookings/route.ts */ \"(rsc)/./src/app/api/admin/bookings/route.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([C_Users_genius_Downloads_drborislavpetrov_src_app_api_admin_bookings_route_ts__WEBPACK_IMPORTED_MODULE_3__]);\nC_Users_genius_Downloads_drborislavpetrov_src_app_api_admin_bookings_route_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/admin/bookings/route\",\n        pathname: \"/api/admin/bookings\",\n        filename: \"route\",\n        bundlePath: \"app/api/admin/bookings/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\genius\\\\Downloads\\\\drborislavpetrov\\\\src\\\\app\\\\api\\\\admin\\\\bookings\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_genius_Downloads_drborislavpetrov_src_app_api_admin_bookings_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/admin/bookings/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhZG1pbiUyRmJvb2tpbmdzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhZG1pbiUyRmJvb2tpbmdzJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYWRtaW4lMkZib29raW5ncyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNnZW5pdXMlNUNEb3dubG9hZHMlNUNkcmJvcmlzbGF2cGV0cm92JTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNnZW5pdXMlNUNEb3dubG9hZHMlNUNkcmJvcmlzbGF2cGV0cm92JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUN3QztBQUNySDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2RyLWJvcmlzbGF2LXBldHJvdi13ZWJzaXRlLz8zZDEwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXGdlbml1c1xcXFxEb3dubG9hZHNcXFxcZHJib3Jpc2xhdnBldHJvdlxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxhZG1pblxcXFxib29raW5nc1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYWRtaW4vYm9va2luZ3Mvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hZG1pbi9ib29raW5nc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYWRtaW4vYm9va2luZ3Mvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxnZW5pdXNcXFxcRG93bmxvYWRzXFxcXGRyYm9yaXNsYXZwZXRyb3ZcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcYWRtaW5cXFxcYm9va2luZ3NcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2FkbWluL2Jvb2tpbmdzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fbookings%2Froute&page=%2Fapi%2Fadmin%2Fbookings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fbookings%2Froute.ts&appDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/admin/bookings/route.ts":
/*!*********************************************!*\
  !*** ./src/app/api/admin/bookings/route.ts ***!
  \*********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   PUT: () => (/* binding */ PUT)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/database */ \"(rsc)/./src/lib/database.ts\");\n/* harmony import */ var _lib_socket__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/socket */ \"(rsc)/./src/lib/socket.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_database__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_database__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Global request counter for debugging\nlet apiRequestCounter = 0;\n// Cache for optional column detection\nlet hasUserIdColumnCache = null;\nasync function ensureHasUserIdColumn(db) {\n    if (hasUserIdColumnCache !== null) return hasUserIdColumnCache;\n    try {\n        const res = await db.query(`SELECT 1 FROM information_schema.columns WHERE table_name = 'bookings' AND column_name = 'user_id' LIMIT 1`);\n        hasUserIdColumnCache = res.rows.length > 0;\n        return hasUserIdColumnCache;\n    } catch  {\n        hasUserIdColumnCache = false;\n        return false;\n    }\n}\n// Функция за проверка на свободни часове\nasync function checkTimeSlotAvailability(db, date, time, serviceId, duration, excludeBookingId) {\n    try {\n        // Първо вземи информация за услугата\n        const serviceResult = await db.query(\"SELECT duration FROM services WHERE id = $1\", [\n            serviceId\n        ]);\n        if (serviceResult.rowCount === 0) {\n            return {\n                available: false,\n                error: \"Service not found\"\n            };\n        }\n        const serviceDuration = duration || serviceResult.rows[0].duration || 30;\n        // Конвертирай времето в минути от началото на деня\n        const [hours, minutes] = time.split(\":\").map(Number);\n        const startTimeMinutes = hours * 60 + minutes;\n        const endTimeMinutes = startTimeMinutes + serviceDuration;\n        // Провери за почивки\n        const breaksResult = await db.query(`\n      SELECT wb.start_time, wb.end_time\n      FROM working_hours wh\n      JOIN working_breaks wb ON wh.id = wb.working_hours_id\n      WHERE wh.date = $1\n    `, [\n            date\n        ]);\n        // Провери дали има конфликт с почивка\n        for (const breakItem of breaksResult.rows){\n            const [breakStartHour, breakStartMinute] = breakItem.start_time.split(\":\").map(Number);\n            const [breakEndHour, breakEndMinute] = breakItem.end_time.split(\":\").map(Number);\n            const breakStartMinutes = breakStartHour * 60 + breakStartMinute;\n            const breakEndMinutes = breakEndHour * 60 + breakEndMinute;\n            // Провери дали има припокриване с почивка\n            if (startTimeMinutes >= breakStartMinutes && startTimeMinutes < breakEndMinutes || endTimeMinutes > breakStartMinutes && endTimeMinutes <= breakEndMinutes || startTimeMinutes <= breakStartMinutes && endTimeMinutes >= breakEndMinutes) {\n                return {\n                    available: false,\n                    error: `Time slot conflicts with break time (${breakItem.start_time} - ${breakItem.end_time})`\n                };\n            }\n        }\n        // Провери за съществуващи резервации в същия ден\n        const existingBookingsQuery = `\n      SELECT b.time, b.serviceduration, b.id\n      FROM bookings b\n      WHERE b.date = $1 \n        AND b.status != 'cancelled'\n        ${excludeBookingId ? \"AND b.id != $2\" : \"\"}\n    `;\n        const existingBookingsParams = excludeBookingId ? [\n            date,\n            excludeBookingId\n        ] : [\n            date\n        ];\n        const existingBookings = await db.query(existingBookingsQuery, existingBookingsParams);\n        // Провери за припокриване\n        for (const booking of existingBookings.rows){\n            const [bookingHours, bookingMinutes] = booking.time.split(\":\").map(Number);\n            const bookingStartMinutes = bookingHours * 60 + bookingMinutes;\n            const bookingDuration = booking.serviceduration || 30;\n            const bookingEndMinutes = bookingStartMinutes + bookingDuration;\n            // Провери дали има припокриване\n            if (startTimeMinutes >= bookingStartMinutes && startTimeMinutes < bookingEndMinutes || endTimeMinutes > bookingStartMinutes && endTimeMinutes <= bookingEndMinutes || startTimeMinutes <= bookingStartMinutes && endTimeMinutes >= bookingEndMinutes) {\n                return {\n                    available: false,\n                    error: `Time slot conflicts with existing booking at ${booking.time}`\n                };\n            }\n        }\n        return {\n            available: true\n        };\n    } catch (error) {\n        console.error(\"Error checking time slot availability:\", error);\n        return {\n            available: false,\n            error: \"Error checking availability\"\n        };\n    }\n}\nasync function GET(request) {\n    apiRequestCounter++;\n    console.log(`🌐 API /admin/bookings GET call #${apiRequestCounter}`);\n    try {\n        const adminToken = request.headers.get(\"x-admin-token\");\n        const { searchParams } = new URL(request.url);\n        const date = searchParams.get(\"date\");\n        const id = searchParams.get(\"id\");\n        console.log(\"\\uD83C\\uDF10 API /admin/bookings GET called:\", {\n            callNumber: apiRequestCounter,\n            hasDate: !!date,\n            hasId: !!id,\n            date: date,\n            id: id,\n            adminToken: adminToken ? \"present\" : \"missing\",\n            userAgent: request.headers.get(\"user-agent\")?.substring(0, 50),\n            timestamp: new Date().toISOString()\n        });\n        if (!adminToken || adminToken !== \"test\" && adminToken !== \"mock-token\") {\n            console.log(\"❌ Unauthorized: invalid admin token\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        // const serviceId = searchParams.get('serviceId') // Unused variable\n        // Ако има date параметър, връщай свободните часове за тази дата\n        if (date) {\n            let db = null;\n            try {\n                db = await (0,_lib_database__WEBPACK_IMPORTED_MODULE_1__.getDatabase)();\n                // Вземи всички резервации за датата\n                const bookingsResult = await db.query(`\n          SELECT b.id, b.time, \n                 COALESCE(b.serviceduration, 30) as serviceDuration\n          FROM bookings b\n          WHERE b.date = $1 AND b.status != 'cancelled'\n          ORDER BY b.time\n        `, [\n                    date\n                ]);\n                // Вземи работното време за датата\n                const workingHoursResult = await db.query(`\n          SELECT wh.start_time, wh.end_time,\n                 COALESCE(\n                   json_agg(\n                     json_build_object(\n                       'id', wb.id,\n                       'startTime', wb.start_time,\n                       'endTime', wb.end_time,\n                       'description', wb.description\n                     )\n                   ) FILTER (WHERE wb.id IS NOT NULL), \n                   '[]'::json\n                 ) as breaks\n          FROM working_hours wh\n          LEFT JOIN working_breaks wb ON wh.id = wb.working_hours_id\n          WHERE wh.date = $1\n          GROUP BY wh.id, wh.start_time, wh.end_time\n        `, [\n                    date\n                ]);\n                // Map serviceduration to serviceDuration for frontend compatibility  \n                const mappedBookedSlots = bookingsResult.rows.map((slot)=>{\n                    const { serviceduration, ...rest } = slot;\n                    return {\n                        ...rest,\n                        serviceDuration: serviceduration || slot.serviceDuration || 30\n                    };\n                });\n                const workingHours = workingHoursResult.rows[0] || null;\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    date,\n                    bookedSlots: mappedBookedSlots,\n                    workingHours,\n                    message: \"Available time slots retrieved successfully\"\n                });\n            } catch (error) {\n                console.error(\"Error fetching available time slots:\", error);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Internal server error\"\n                }, {\n                    status: 500\n                });\n            } finally{\n                if (db) {\n                    db.release();\n                }\n            }\n        }\n        // Ако няма date параметър, връщай всички резервации\n        let db = null;\n        try {\n            db = await (0,_lib_database__WEBPACK_IMPORTED_MODULE_1__.getDatabase)();\n            const hasUserId = await ensureHasUserIdColumn(db);\n            const result = await db.query(hasUserId ? `\n        SELECT b.*, \n               COALESCE(s.name, b.service::text) as serviceName, \n               COALESCE(b.serviceduration, s.duration, 30) as serviceDuration,\n               u.id as userId,\n               u.name as userName, \n               u.email as userEmail\n        FROM bookings b\n        LEFT JOIN services s ON (\n          b.service::text = s.id::text OR b.service = s.name\n        )\n        LEFT JOIN users u ON (\n          b.user_id = u.id\n          OR (b.user_id IS NULL AND b.phone IS NOT NULL AND u.phone IS NOT NULL AND right(regexp_replace(b.phone, '[^0-9]', '', 'g'), 9) = right(regexp_replace(u.phone, '[^0-9]', '', 'g'), 9))\n          OR (b.user_id IS NULL AND b.email IS NOT NULL AND u.email IS NOT NULL AND LOWER(b.email) = LOWER(u.email))\n          OR (\n            b.user_id IS NULL \n            AND (b.phone IS NULL OR b.phone = '') AND (u.phone IS NULL OR u.phone = '') \n            AND (b.email IS NULL OR b.email = '') AND (u.email IS NULL OR u.email = '') \n            AND LOWER(regexp_replace(trim(b.name), '\\\\s+', ' ', 'g')) = LOWER(regexp_replace(trim(u.name), '\\\\s+', ' ', 'g'))\n          )\n        )\n        ORDER BY b.createdat DESC\n      ` : `\n        SELECT b.*, \n               COALESCE(s.name, b.service::text) as serviceName, \n               COALESCE(b.serviceduration, s.duration, 30) as serviceDuration,\n               u.id as userId,\n               u.name as userName, \n               u.email as userEmail\n        FROM bookings b\n        LEFT JOIN services s ON (\n          b.service::text = s.id::text OR b.service = s.name\n        )\n        LEFT JOIN users u ON (\n          (b.phone IS NOT NULL AND u.phone IS NOT NULL AND right(regexp_replace(b.phone, '[^0-9]', '', 'g'), 9) = right(regexp_replace(u.phone, '[^0-9]', '', 'g'), 9))\n          OR (b.email IS NOT NULL AND u.email IS NOT NULL AND LOWER(b.email) = LOWER(u.email))\n          OR ((b.phone IS NULL OR b.phone = '') AND (u.phone IS NULL OR u.phone = '') AND (b.email IS NULL OR b.email = '') AND (u.email IS NULL OR u.email = '') AND LOWER(b.name) = LOWER(u.name))\n        )\n        ORDER BY b.createdat DESC\n      `);\n            // Map serviceduration to serviceDuration for frontend compatibility\n            const mappedBookings = result.rows.map((booking)=>{\n                const { serviceduration, createdat, ...rest } = booking;\n                return {\n                    ...rest,\n                    createdAt: createdat || booking.createdAt,\n                    serviceDuration: serviceduration || booking.serviceDuration || 30\n                };\n            });\n            // Deduplicate by booking id to avoid inflated counts due to JOINs\n            const uniqueById = new Map();\n            for (const b of mappedBookings){\n                const key = b && b.id ? String(b.id) : JSON.stringify(b);\n                if (!uniqueById.has(key)) {\n                    uniqueById.set(key, b);\n                }\n            }\n            const uniqueBookings = Array.from(uniqueById.values());\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                bookings: uniqueBookings\n            });\n        } catch (error) {\n            console.error(\"Error fetching bookings:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Internal server error\"\n            }, {\n                status: 500\n            });\n        } finally{\n            if (db) {\n                db.release();\n            }\n        }\n    } catch (error) {\n        console.error(\"Error fetching bookings:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function POST(request) {\n    try {\n        const adminToken = request.headers.get(\"x-admin-token\");\n        if (!adminToken) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const body = await request.json();\n        const { name, email, phone, service, serviceDuration, date, time, message } = body;\n        // Admin can create bookings without phone - only name, service, date, time are required\n        if (!name || !service || !date || !time) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing required fields: name, service, date, time\"\n            }, {\n                status: 400\n            });\n        }\n        // Validate time format\n        const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;\n        if (!timeRegex.test(time)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid time format. Please use HH:MM format (e.g., 14:30)\"\n            }, {\n                status: 400\n            });\n        }\n        // Validate date format\n        const dateRegex = /^\\d{4}-\\d{2}-\\d{2}$/;\n        if (!dateRegex.test(date)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid date format. Please use YYYY-MM-DD format\"\n            }, {\n                status: 400\n            });\n        }\n        const db = await (0,_lib_database__WEBPACK_IMPORTED_MODULE_1__.getDatabase)();\n        // Автоматично създаване на потребител ако phone е предоставен\n        if (phone && phone.trim()) {\n            // Check if user exists by phone number\n            const user = await db.query(\"SELECT * FROM users WHERE phone = $1\", [\n                phone.trim()\n            ]);\n            if (user.rows.length === 0) {\n                // Create new user\n                await db.query(`\n          INSERT INTO users (name, email, phone)\n          VALUES ($1, $2, $3)\n          RETURNING id\n        `, [\n                    name,\n                    email || null,\n                    phone.trim()\n                ]);\n                console.log(`✅ Created new user for phone: ${phone.trim()}`);\n            } else {\n                // Update existing user's information if needed\n                const existingUser = user.rows[0];\n                if (existingUser.name !== name || existingUser.email !== email) {\n                    await db.query(`\n            UPDATE users \n            SET name = $1, email = $2, updatedAt = CURRENT_TIMESTAMP\n            WHERE id = $3\n          `, [\n                        name,\n                        email || null,\n                        existingUser.id\n                    ]);\n                    console.log(`✅ Updated existing user for phone: ${phone.trim()}`);\n                }\n            }\n        }\n        // Провери дали часът е свободен\n        const availabilityCheck = await checkTimeSlotAvailability(db, date, time, parseInt(service), serviceDuration);\n        if (!availabilityCheck.available) {\n            db.release();\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: availabilityCheck.error\n            }, {\n                status: 409\n            } // Conflict\n            );\n        }\n        // Insert new booking (phone can be null for admin bookings)\n        // Try to resolve user_id when possible by phone/email/name\n        let resolvedUserId = null;\n        try {\n            const userLookup = await db.query(`\n        SELECT id FROM users \n        WHERE (\n          ($1 IS NOT NULL AND $1 <> '' AND phone IS NOT NULL AND right(regexp_replace(phone, '[^0-9]', '', 'g'), 9) = right(regexp_replace($1, '[^0-9]', '', 'g'), 9))\n        ) OR (\n          ($2 IS NOT NULL AND $2 <> '' AND email IS NOT NULL AND LOWER(email) = LOWER($2))\n        ) OR (\n          ($1 IS NULL OR $1 = '') AND ($2 IS NULL OR $2 = '') AND LOWER(name) = LOWER($3)\n        )\n        LIMIT 1\n      `, [\n                phone || null,\n                email || null,\n                name\n            ]);\n            if (userLookup.rows[0]) {\n                resolvedUserId = userLookup.rows[0].id;\n            }\n        } catch (e) {\n            console.warn(\"User lookup failed, proceeding without user_id\");\n        }\n        const hasUserId = await ensureHasUserIdColumn(db);\n        const result = await db.query(hasUserId ? `\n      INSERT INTO bookings (name, email, phone, service, serviceduration, date, time, message, status, createdat, user_id)\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, CURRENT_TIMESTAMP, $10)\n      RETURNING id, createdat\n    ` : `\n      INSERT INTO bookings (name, email, phone, service, serviceduration, date, time, message, status, createdat)\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, CURRENT_TIMESTAMP)\n      RETURNING id, createdat\n    `, hasUserId ? [\n            name,\n            email || null,\n            phone || null,\n            parseInt(service),\n            serviceDuration || 30,\n            date,\n            time,\n            message || null,\n            \"pending\",\n            resolvedUserId\n        ] : [\n            name,\n            email || null,\n            phone || null,\n            parseInt(service),\n            serviceDuration || 30,\n            date,\n            time,\n            message || null,\n            \"pending\"\n        ]);\n        const newBookingId = result.rows[0].id;\n        const newCreatedAt = result.rows[0].createdat;\n        const newBooking = {\n            id: newBookingId,\n            name,\n            email,\n            phone,\n            userId: hasUserId ? resolvedUserId || undefined : undefined,\n            service,\n            serviceDuration: serviceDuration || 30,\n            date,\n            time,\n            message,\n            status: \"pending\",\n            createdAt: newCreatedAt\n        };\n        db.release();\n        // Emit WebSocket event for real-time updates\n        try {\n            // Enrich with serviceName for immediate UI display\n            const svc = await db.query(\"SELECT name FROM services WHERE id::text = $1 OR name = $1\", [\n                String(service)\n            ]);\n            const enriched = {\n                ...newBooking,\n                serviceName: svc.rows[0]?.name || String(service)\n            };\n            (0,_lib_socket__WEBPACK_IMPORTED_MODULE_2__.emitBookingAdded)(enriched);\n        } catch (error) {\n            console.error(\"WebSocket emit error:\", error);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            message: \"Booking created successfully\",\n            id: newBookingId\n        });\n    } catch (error) {\n        console.error(\"Error creating booking:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function PUT(request) {\n    try {\n        const adminToken = request.headers.get(\"x-admin-token\");\n        if (!adminToken) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const body = await request.json();\n        console.log(\"\\uD83D\\uDD0D [PUT Bookings] Request body:\", body);\n        const { id, status, treatment_notes, ...otherFields } = body;\n        console.log(\"\\uD83D\\uDD0D [PUT Bookings] Extracted data:\", {\n            id,\n            status,\n            treatment_notes,\n            otherFields\n        });\n        if (!id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Booking ID is required\"\n            }, {\n                status: 400\n            });\n        }\n        const db = await (0,_lib_database__WEBPACK_IMPORTED_MODULE_1__.getDatabase)();\n        // Check if this is a status-only update\n        const hasStatusOnly = status !== undefined && Object.keys(otherFields).length === 0;\n        const hasTreatmentNotesOnly = treatment_notes !== undefined && Object.keys(otherFields).length === 0;\n        if (hasStatusOnly) {\n            await db.query(\"UPDATE bookings SET status = $1 WHERE id = $2\", [\n                status,\n                id\n            ]);\n        } else if (hasTreatmentNotesOnly) {\n            await db.query(\"UPDATE bookings SET treatment_notes = $1 WHERE id = $2\", [\n                treatment_notes,\n                id\n            ]);\n        } else {\n            // Update booking details (name, email, phone, service, etc.)\n            const { name, email, phone, service, serviceDuration, date, time, message } = otherFields;\n            console.log(\"\\uD83D\\uDD0D [PUT Bookings] Update booking details:\", {\n                name,\n                email,\n                phone,\n                service,\n                serviceDuration,\n                date,\n                time,\n                message\n            });\n            if (date && time && service) {\n                const availabilityCheck = await checkTimeSlotAvailability(db, date, time, parseInt(service), serviceDuration, parseInt(id));\n                if (!availabilityCheck.available) {\n                    db.release();\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: availabilityCheck.error\n                    }, {\n                        status: 409\n                    });\n                }\n            }\n            console.log(\"\\uD83D\\uDD0D [PUT Bookings] SQL Update params:\", [\n                name,\n                email || null,\n                phone,\n                service,\n                serviceDuration || 30,\n                date,\n                time,\n                message || null,\n                status || \"pending\",\n                id\n            ]);\n            const result = await db.query(`\n        UPDATE bookings\n        SET name = $1, email = $2, phone = $3, service = $4, serviceduration = $5, date = $6, time = $7, message = $8, status = $9\n        WHERE id = $10\n      `, [\n                name,\n                email || null,\n                phone,\n                service,\n                serviceDuration || 30,\n                date,\n                time,\n                message || null,\n                status || \"pending\",\n                id\n            ]);\n            console.log(\"\\uD83D\\uDD0D [PUT Bookings] SQL Update result:\", result.rowCount);\n        }\n        db.release();\n        // Get the updated booking for WebSocket event\n        const updatedBooking = await db.query(`\n      SELECT b.*, \n             COALESCE(s.name, b.service::text) as serviceName,\n             COALESCE(b.serviceduration, s.duration, 30) as serviceDuration,\n             u.name as userName, \n             u.email as userEmail\n      FROM bookings b\n      LEFT JOIN services s ON (\n        b.service::text = s.id::text OR b.service = s.name\n      )\n      LEFT JOIN users u ON b.phone = u.phone\n      WHERE b.id = $1\n    `, [\n            id\n        ]);\n        const mapped = (()=>{\n            const row = updatedBooking.rows[0];\n            if (!row) return null;\n            const { serviceduration, createdat, ...rest } = row;\n            return {\n                ...rest,\n                createdAt: createdat || row.createdAt,\n                serviceDuration: serviceduration || row.serviceDuration || 30\n            };\n        })();\n        try {\n            if (mapped) (0,_lib_socket__WEBPACK_IMPORTED_MODULE_2__.emitBookingUpdate)(mapped);\n        } catch (error) {\n            console.error(\"WebSocket emit error:\", error);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            message: \"Booking updated successfully\",\n            booking: mapped\n        });\n    } catch (error) {\n        console.error(\"Error updating booking:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function DELETE(request) {\n    try {\n        const adminToken = request.headers.get(\"x-admin-token\");\n        if (!adminToken) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const { searchParams } = new URL(request.url);\n        const id = searchParams.get(\"id\");\n        if (!id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Booking ID is required\"\n            }, {\n                status: 400\n            });\n        }\n        const db = await (0,_lib_database__WEBPACK_IMPORTED_MODULE_1__.getDatabase)();\n        await db.query(\"DELETE FROM bookings WHERE id = $1\", [\n            id\n        ]);\n        db.release();\n        // Emit WebSocket event for real-time updates\n        try {\n            (0,_lib_socket__WEBPACK_IMPORTED_MODULE_2__.emitBookingDeleted)(id);\n        } catch (error) {\n            console.error(\"WebSocket emit error:\", error);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            message: \"Booking deleted successfully\"\n        });\n    } catch (error) {\n        console.error(\"Error deleting booking:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hZG1pbi9ib29raW5ncy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQXVEO0FBQ1g7QUFFMEM7QUFFdEYsdUNBQXVDO0FBQ3ZDLElBQUlLLG9CQUFvQjtBQUV4QixzQ0FBc0M7QUFDdEMsSUFBSUMsdUJBQXVDO0FBRTNDLGVBQWVDLHNCQUFzQkMsRUFBYztJQUNqRCxJQUFJRix5QkFBeUIsTUFBTSxPQUFPQTtJQUMxQyxJQUFJO1FBQ0YsTUFBTUcsTUFBTSxNQUFNRCxHQUFHRSxLQUFLLENBQ3hCLENBQUMsMEdBQTBHLENBQUM7UUFFOUdKLHVCQUF1QkcsSUFBSUUsSUFBSSxDQUFDQyxNQUFNLEdBQUc7UUFDekMsT0FBT047SUFDVCxFQUFFLE9BQU07UUFDTkEsdUJBQXVCO1FBQ3ZCLE9BQU87SUFDVDtBQUNGO0FBRUEseUNBQXlDO0FBQ3pDLGVBQWVPLDBCQUEwQkwsRUFBYyxFQUFFTSxJQUFZLEVBQUVDLElBQVksRUFBRUMsU0FBaUIsRUFBRUMsUUFBZ0IsRUFBRUMsZ0JBQXlCO0lBQ2pKLElBQUk7UUFDRixxQ0FBcUM7UUFDckMsTUFBTUMsZ0JBQWdCLE1BQU1YLEdBQUdFLEtBQUssQ0FBQywrQ0FBK0M7WUFBQ007U0FBVTtRQUMvRixJQUFJRyxjQUFjQyxRQUFRLEtBQUssR0FBRztZQUNoQyxPQUFPO2dCQUFFQyxXQUFXO2dCQUFPQyxPQUFPO1lBQW9CO1FBQ3hEO1FBRUEsTUFBTUMsa0JBQWtCTixZQUFZRSxjQUFjUixJQUFJLENBQUMsRUFBRSxDQUFDTSxRQUFRLElBQUk7UUFFdEUsbURBQW1EO1FBQ25ELE1BQU0sQ0FBQ08sT0FBT0MsUUFBUSxHQUFHVixLQUFLVyxLQUFLLENBQUMsS0FBS0MsR0FBRyxDQUFDQztRQUM3QyxNQUFNQyxtQkFBbUJMLFFBQVEsS0FBS0M7UUFDdEMsTUFBTUssaUJBQWlCRCxtQkFBbUJOO1FBRTFDLHFCQUFxQjtRQUNyQixNQUFNUSxlQUFlLE1BQU12QixHQUFHRSxL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O1FBRUEsTUFBTS9ELEtBQUssTUFBTVAsMERBQVdBO1FBQzVCLE1BQU1PLEdBQUdFLEtBQUssQ0FBQyxzQ0FBc0M7WUFBQ21EO1NBQUc7UUFFekRyRCxHQUFHd0UsT0FBTztRQUVWLDZDQUE2QztRQUM3QyxJQUFJO1lBQ0Y3RSwrREFBa0JBLENBQUMwRDtRQUNyQixFQUFFLE9BQU92QyxPQUFPO1lBQ2Q2QixRQUFRN0IsS0FBSyxDQUFDLHlCQUF5QkE7UUFDekM7UUFFQSxPQUFPdEIscURBQVlBLENBQUNzRSxJQUFJLENBQUM7WUFDdkJTLFNBQVM7UUFDWDtJQUNGLEVBQUUsT0FBT3pELE9BQU87UUFDZDZCLFFBQVE3QixLQUFLLENBQUMsMkJBQTJCQTtRQUN6QyxPQUFPdEIscURBQVlBLENBQUNzRSxJQUFJLENBQ3RCO1lBQUVoRCxPQUFPO1FBQXdCLEdBQ2pDO1lBQUVpRCxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2RyLWJvcmlzbGF2LXBldHJvdi13ZWJzaXRlLy4vc3JjL2FwcC9hcGkvYWRtaW4vYm9va2luZ3Mvcm91dGUudHM/N2YxNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBnZXREYXRhYmFzZSB9IGZyb20gJ0AvbGliL2RhdGFiYXNlJ1xuaW1wb3J0IHR5cGUgeyBQb29sQ2xpZW50IH0gZnJvbSAncGcnXG5pbXBvcnQgeyBlbWl0Qm9va2luZ0FkZGVkLCBlbWl0Qm9va2luZ0RlbGV0ZWQsIGVtaXRCb29raW5nVXBkYXRlIH0gZnJvbSAnQC9saWIvc29ja2V0J1xuXG4vLyBHbG9iYWwgcmVxdWVzdCBjb3VudGVyIGZvciBkZWJ1Z2dpbmdcbmxldCBhcGlSZXF1ZXN0Q291bnRlciA9IDBcblxuLy8gQ2FjaGUgZm9yIG9wdGlvbmFsIGNvbHVtbiBkZXRlY3Rpb25cbmxldCBoYXNVc2VySWRDb2x1bW5DYWNoZTogYm9vbGVhbiB8IG51bGwgPSBudWxsXG5cbmFzeW5jIGZ1bmN0aW9uIGVuc3VyZUhhc1VzZXJJZENvbHVtbihkYjogUG9vbENsaWVudCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBpZiAoaGFzVXNlcklkQ29sdW1uQ2FjaGUgIT09IG51bGwpIHJldHVybiBoYXNVc2VySWRDb2x1bW5DYWNoZVxuICB0cnkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRiLnF1ZXJ5KFxuICAgICAgYFNFTEVDVCAxIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgV0hFUkUgdGFibGVfbmFtZSA9ICdib29raW5ncycgQU5EIGNvbHVtbl9uYW1lID0gJ3VzZXJfaWQnIExJTUlUIDFgXG4gICAgKVxuICAgIGhhc1VzZXJJZENvbHVtbkNhY2hlID0gcmVzLnJvd3MubGVuZ3RoID4gMFxuICAgIHJldHVybiBoYXNVc2VySWRDb2x1bW5DYWNoZVxuICB9IGNhdGNoIHtcbiAgICBoYXNVc2VySWRDb2x1bW5DYWNoZSA9IGZhbHNlXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbn1cblxuLy8g0KTRg9C90LrRhtC40Y8g0LfQsCDQv9GA0L7QstC10YDQutCwINC90LAg0YHQstC+0LHQvtC00L3QuCDRh9Cw0YHQvtCy0LVcbmFzeW5jIGZ1bmN0aW9uIGNoZWNrVGltZVNsb3RBdmFpbGFiaWxpdHkoZGI6IFBvb2xDbGllbnQsIGRhdGU6IHN0cmluZywgdGltZTogc3RyaW5nLCBzZXJ2aWNlSWQ6IG51bWJlciwgZHVyYXRpb246IG51bWJlciwgZXhjbHVkZUJvb2tpbmdJZD86IG51bWJlcikge1xuICB0cnkge1xuICAgIC8vINCf0YrRgNCy0L4g0LLQt9C10LzQuCDQuNC90YTQvtGA0LzQsNGG0LjRjyDQt9CwINGD0YHQu9GD0LPQsNGC0LBcbiAgICBjb25zdCBzZXJ2aWNlUmVzdWx0ID0gYXdhaXQgZGIucXVlcnkoJ1NFTEVDVCBkdXJhdGlvbiBGUk9NIHNlcnZpY2VzIFdIRVJFIGlkID0gJDEnLCBbc2VydmljZUlkXSlcbiAgICBpZiAoc2VydmljZVJlc3VsdC5yb3dDb3VudCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHsgYXZhaWxhYmxlOiBmYWxzZSwgZXJyb3I6ICdTZXJ2aWNlIG5vdCBmb3VuZCcgfVxuICAgIH1cbiAgICBcbiAgICBjb25zdCBzZXJ2aWNlRHVyYXRpb24gPSBkdXJhdGlvbiB8fCBzZXJ2aWNlUmVzdWx0LnJvd3NbMF0uZHVyYXRpb24gfHwgMzBcbiAgICBcbiAgICAvLyDQmtC+0L3QstC10YDRgtC40YDQsNC5INCy0YDQtdC80LXRgtC+INCyINC80LjQvdGD0YLQuCDQvtGCINC90LDRh9Cw0LvQvtGC0L4g0L3QsCDQtNC10L3Rj1xuICAgIGNvbnN0IFtob3VycywgbWludXRlc10gPSB0aW1lLnNwbGl0KCc6JykubWFwKE51bWJlcilcbiAgICBjb25zdCBzdGFydFRpbWVNaW51dGVzID0gaG91cnMgKiA2MCArIG1pbnV0ZXNcbiAgICBjb25zdCBlbmRUaW1lTWludXRlcyA9IHN0YXJ0VGltZU1pbnV0ZXMgKyBzZXJ2aWNlRHVyYXRpb25cbiAgICBcbiAgICAvLyDQn9GA0L7QstC10YDQuCDQt9CwINC/0L7Rh9C40LLQutC4XG4gICAgY29uc3QgYnJlYWtzUmVzdWx0ID0gYXdhaXQgZGIucXVlcnkoYFxuICAgICAgU0VMRUNUIHdiLnN0YXJ0X3RpbWUsIHdiLmVuZF90aW1lXG4gICAgICBGUk9NIHdvcmtpbmdfaG91cnMgd2hcbiAgICAgIEpPSU4gd29ya2luZ19icmVha3Mgd2IgT04gd2guaWQgPSB3Yi53b3JraW5nX2hvdXJzX2lkXG4gICAgICBXSEVSRSB3aC5kYXRlID0gJDFcbiAgICBgLCBbZGF0ZV0pXG4gICAgXG4gICAgLy8g0J/RgNC+0LLQtdGA0Lgg0LTQsNC70Lgg0LjQvNCwINC60L7QvdGE0LvQuNC60YIg0YEg0L/QvtGH0LjQstC60LBcbiAgICBmb3IgKGNvbnN0IGJyZWFrSXRlbSBvZiBicmVha3NSZXN1bHQucm93cykge1xuICAgICAgY29uc3QgW2JyZWFrU3RhcnRIb3VyLCBicmVha1N0YXJ0TWludXRlXSA9IGJyZWFrSXRlbS5zdGFydF90aW1lLnNwbGl0KCc6JykubWFwKE51bWJlcilcbiAgICAgIGNvbnN0IFticmVha0VuZEhvdXIsIGJyZWFrRW5kTWludXRlXSA9IGJyZWFrSXRlbS5lbmRfdGltZS5zcGxpdCgnOicpLm1hcChOdW1iZXIpXG4gICAgICBjb25zdCBicmVha1N0YXJ0TWludXRlcyA9IGJyZWFrU3RhcnRIb3VyICogNjAgKyBicmVha1N0YXJ0TWludXRlXG4gICAgICBjb25zdCBicmVha0VuZE1pbnV0ZXMgPSBicmVha0VuZEhvdXIgKiA2MCArIGJyZWFrRW5kTWludXRlXG4gICAgICBcbiAgICAgIC8vINCf0YDQvtCy0LXRgNC4INC00LDQu9C4INC40LzQsCDQv9GA0LjQv9C+0LrRgNC40LLQsNC90LUg0YEg0L/QvtGH0LjQstC60LBcbiAgICAgIGlmIChcbiAgICAgICAgKHN0YXJ0VGltZU1pbnV0ZXMgPj0gYnJlYWtTdGFydE1pbnV0ZXMgJiYgc3RhcnRUaW1lTWludXRlcyA8IGJyZWFrRW5kTWludXRlcykgfHxcbiAgICAgICAgKGVuZFRpbWVNaW51dGVzID4gYnJlYWtTdGFydE1pbnV0ZXMgJiYgZW5kVGltZU1pbnV0ZXMgPD0gYnJlYWtFbmRNaW51dGVzKSB8fFxuICAgICAgICAoc3RhcnRUaW1lTWludXRlcyA8PSBicmVha1N0YXJ0TWludXRlcyAmJiBlbmRUaW1lTWludXRlcyA+PSBicmVha0VuZE1pbnV0ZXMpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHsgXG4gICAgICAgICAgYXZhaWxhYmxlOiBmYWxzZSwgXG4gICAgICAgICAgZXJyb3I6IGBUaW1lIHNsb3QgY29uZmxpY3RzIHdpdGggYnJlYWsgdGltZSAoJHticmVha0l0ZW0uc3RhcnRfdGltZX0gLSAke2JyZWFrSXRlbS5lbmRfdGltZX0pYCBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyDQn9GA0L7QstC10YDQuCDQt9CwINGB0YrRidC10YHRgtCy0YPQstCw0YnQuCDRgNC10LfQtdGA0LLQsNGG0LjQuCDQsiDRgdGK0YnQuNGPINC00LXQvVxuICAgIGNvbnN0IGV4aXN0aW5nQm9va2luZ3NRdWVyeSA9IGBcbiAgICAgIFNFTEVDVCBiLnRpbWUsIGIuc2VydmljZWR1cmF0aW9uLCBiLmlkXG4gICAgICBGUk9NIGJvb2tpbmdzIGJcbiAgICAgIFdIRVJFIGIuZGF0ZSA9ICQxIFxuICAgICAgICBBTkQgYi5zdGF0dXMgIT0gJ2NhbmNlbGxlZCdcbiAgICAgICAgJHtleGNsdWRlQm9va2luZ0lkID8gJ0FORCBiLmlkICE9ICQyJyA6ICcnfVxuICAgIGBcbiAgICBcbiAgICBjb25zdCBleGlzdGluZ0Jvb2tpbmdzUGFyYW1zID0gZXhjbHVkZUJvb2tpbmdJZCA/IFtkYXRlLCBleGNsdWRlQm9va2luZ0lkXSA6IFtkYXRlXVxuICAgIGNvbnN0IGV4aXN0aW5nQm9va2luZ3MgPSBhd2FpdCBkYi5xdWVyeShleGlzdGluZ0Jvb2tpbmdzUXVlcnksIGV4aXN0aW5nQm9va2luZ3NQYXJhbXMpXG4gICAgXG4gICAgLy8g0J/RgNC+0LLQtdGA0Lgg0LfQsCDQv9GA0LjQv9C+0LrRgNC40LLQsNC90LVcbiAgICBmb3IgKGNvbnN0IGJvb2tpbmcgb2YgZXhpc3RpbmdCb29raW5ncy5yb3dzKSB7XG4gICAgICBjb25zdCBbYm9va2luZ0hvdXJzLCBib29raW5nTWludXRlc10gPSBib29raW5nLnRpbWUuc3BsaXQoJzonKS5tYXAoTnVtYmVyKVxuICAgICAgY29uc3QgYm9va2luZ1N0YXJ0TWludXRlcyA9IGJvb2tpbmdIb3VycyAqIDYwICsgYm9va2luZ01pbnV0ZXNcbiAgICAgIGNvbnN0IGJvb2tpbmdEdXJhdGlvbiA9IGJvb2tpbmcuc2VydmljZWR1cmF0aW9uIHx8IDMwXG4gICAgICBjb25zdCBib29raW5nRW5kTWludXRlcyA9IGJvb2tpbmdTdGFydE1pbnV0ZXMgKyBib29raW5nRHVyYXRpb25cbiAgICAgIFxuICAgICAgLy8g0J/RgNC+0LLQtdGA0Lgg0LTQsNC70Lgg0LjQvNCwINC/0YDQuNC/0L7QutGA0LjQstCw0L3QtVxuICAgICAgaWYgKFxuICAgICAgICAoc3RhcnRUaW1lTWludXRlcyA+PSBib29raW5nU3RhcnRNaW51dGVzICYmIHN0YXJ0VGltZU1pbnV0ZXMgPCBib29raW5nRW5kTWludXRlcykgfHxcbiAgICAgICAgKGVuZFRpbWVNaW51dGVzID4gYm9va2luZ1N0YXJ0TWludXRlcyAmJiBlbmRUaW1lTWludXRlcyA8PSBib29raW5nRW5kTWludXRlcykgfHxcbiAgICAgICAgKHN0YXJ0VGltZU1pbnV0ZXMgPD0gYm9va2luZ1N0YXJ0TWludXRlcyAmJiBlbmRUaW1lTWludXRlcyA+PSBib29raW5nRW5kTWludXRlcylcbiAgICAgICkge1xuICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICBhdmFpbGFibGU6IGZhbHNlLCBcbiAgICAgICAgICBlcnJvcjogYFRpbWUgc2xvdCBjb25mbGljdHMgd2l0aCBleGlzdGluZyBib29raW5nIGF0ICR7Ym9va2luZy50aW1lfWAgXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgYXZhaWxhYmxlOiB0cnVlIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyB0aW1lIHNsb3QgYXZhaWxhYmlsaXR5OicsIGVycm9yKVxuICAgIHJldHVybiB7IGF2YWlsYWJsZTogZmFsc2UsIGVycm9yOiAnRXJyb3IgY2hlY2tpbmcgYXZhaWxhYmlsaXR5JyB9XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICBhcGlSZXF1ZXN0Q291bnRlcisrXG4gIGNvbnNvbGUubG9nKGDwn4yQIEFQSSAvYWRtaW4vYm9va2luZ3MgR0VUIGNhbGwgIyR7YXBpUmVxdWVzdENvdW50ZXJ9YClcbiAgXG4gIHRyeSB7XG4gICAgY29uc3QgYWRtaW5Ub2tlbiA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ3gtYWRtaW4tdG9rZW4nKVxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKVxuICAgIGNvbnN0IGRhdGUgPSBzZWFyY2hQYXJhbXMuZ2V0KCdkYXRlJylcbiAgICBjb25zdCBpZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ2lkJylcbiAgICBcbiAgICBjb25zb2xlLmxvZygn8J+MkCBBUEkgL2FkbWluL2Jvb2tpbmdzIEdFVCBjYWxsZWQ6JywgeyBcbiAgICAgIGNhbGxOdW1iZXI6IGFwaVJlcXVlc3RDb3VudGVyLFxuICAgICAgaGFzRGF0ZTogISFkYXRlLCBcbiAgICAgIGhhc0lkOiAhIWlkLCBcbiAgICAgIGRhdGU6IGRhdGUsXG4gICAgICBpZDogaWQsXG4gICAgICBhZG1pblRva2VuOiBhZG1pblRva2VuID8gJ3ByZXNlbnQnIDogJ21pc3NpbmcnLFxuICAgICAgdXNlckFnZW50OiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50Jyk/LnN1YnN0cmluZygwLCA1MCksXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgIH0pXG4gICAgXG4gICAgaWYgKCFhZG1pblRva2VuIHx8IChhZG1pblRva2VuICE9PSAndGVzdCcgJiYgYWRtaW5Ub2tlbiAhPT0gJ21vY2stdG9rZW4nKSkge1xuICAgICAgY29uc29sZS5sb2coJ+KdjCBVbmF1dGhvcml6ZWQ6IGludmFsaWQgYWRtaW4gdG9rZW4nKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyBjb25zdCBzZXJ2aWNlSWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCdzZXJ2aWNlSWQnKSAvLyBVbnVzZWQgdmFyaWFibGVcbiAgICBcbiAgICAvLyDQkNC60L4g0LjQvNCwIGRhdGUg0L/QsNGA0LDQvNC10YLRitGALCDQstGA0YrRidCw0Lkg0YHQstC+0LHQvtC00L3QuNGC0LUg0YfQsNGB0L7QstC1INC30LAg0YLQsNC30Lgg0LTQsNGC0LBcbiAgICBpZiAoZGF0ZSkge1xuICAgICAgbGV0IGRiOiBQb29sQ2xpZW50IHwgbnVsbCA9IG51bGxcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgZGIgPSBhd2FpdCBnZXREYXRhYmFzZSgpXG4gICAgICAgIFxuICAgICAgICAvLyDQktC30LXQvNC4INCy0YHQuNGH0LrQuCDRgNC10LfQtdGA0LLQsNGG0LjQuCDQt9CwINC00LDRgtCw0YLQsFxuICAgICAgICBjb25zdCBib29raW5nc1Jlc3VsdCA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICAgICAgICBTRUxFQ1QgYi5pZCwgYi50aW1lLCBcbiAgICAgICAgICAgICAgICAgQ09BTEVTQ0UoYi5zZXJ2aWNlZHVyYXRpb24sIDMwKSBhcyBzZXJ2aWNlRHVyYXRpb25cbiAgICAgICAgICBGUk9NIGJvb2tpbmdzIGJcbiAgICAgICAgICBXSEVSRSBiLmRhdGUgPSAkMSBBTkQgYi5zdGF0dXMgIT0gJ2NhbmNlbGxlZCdcbiAgICAgICAgICBPUkRFUiBCWSBiLnRpbWVcbiAgICAgICAgYCwgW2RhdGVdKVxuICAgICAgICBcbiAgICAgICAgLy8g0JLQt9C10LzQuCDRgNCw0LHQvtGC0L3QvtGC0L4g0LLRgNC10LzQtSDQt9CwINC00LDRgtCw0YLQsFxuICAgICAgICBjb25zdCB3b3JraW5nSG91cnNSZXN1bHQgPSBhd2FpdCBkYi5xdWVyeShgXG4gICAgICAgICAgU0VMRUNUIHdoLnN0YXJ0X3RpbWUsIHdoLmVuZF90aW1lLFxuICAgICAgICAgICAgICAgICBDT0FMRVNDRShcbiAgICAgICAgICAgICAgICAgICBqc29uX2FnZyhcbiAgICAgICAgICAgICAgICAgICAgIGpzb25fYnVpbGRfb2JqZWN0KFxuICAgICAgICAgICAgICAgICAgICAgICAnaWQnLCB3Yi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXJ0VGltZScsIHdiLnN0YXJ0X3RpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICdlbmRUaW1lJywgd2IuZW5kX3RpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICdkZXNjcmlwdGlvbicsIHdiLmRlc2NyaXB0aW9uXG4gICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgKSBGSUxURVIgKFdIRVJFIHdiLmlkIElTIE5PVCBOVUxMKSwgXG4gICAgICAgICAgICAgICAgICAgJ1tdJzo6anNvblxuICAgICAgICAgICAgICAgICApIGFzIGJyZWFrc1xuICAgICAgICAgIEZST00gd29ya2luZ19ob3VycyB3aFxuICAgICAgICAgIExFRlQgSk9JTiB3b3JraW5nX2JyZWFrcyB3YiBPTiB3aC5pZCA9IHdiLndvcmtpbmdfaG91cnNfaWRcbiAgICAgICAgICBXSEVSRSB3aC5kYXRlID0gJDFcbiAgICAgICAgICBHUk9VUCBCWSB3aC5pZCwgd2guc3RhcnRfdGltZSwgd2guZW5kX3RpbWVcbiAgICAgICAgYCwgW2RhdGVdKVxuICAgICAgICBcbiAgICAgICAgLy8gTWFwIHNlcnZpY2VkdXJhdGlvbiB0byBzZXJ2aWNlRHVyYXRpb24gZm9yIGZyb250ZW5kIGNvbXBhdGliaWxpdHkgIFxuICAgICAgICBjb25zdCBtYXBwZWRCb29rZWRTbG90cyA9IGJvb2tpbmdzUmVzdWx0LnJvd3MubWFwKChzbG90OiB7IHNlcnZpY2VkdXJhdGlvbj86IG51bWJlcjsgc2VydmljZUR1cmF0aW9uPzogbnVtYmVyIH0pID0+IHtcbiAgICAgICAgICBjb25zdCB7IHNlcnZpY2VkdXJhdGlvbiwgLi4ucmVzdCB9ID0gc2xvdFxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgc2VydmljZUR1cmF0aW9uOiBzZXJ2aWNlZHVyYXRpb24gfHwgc2xvdC5zZXJ2aWNlRHVyYXRpb24gfHwgMzBcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIFxuICAgICAgICBjb25zdCB3b3JraW5nSG91cnMgPSB3b3JraW5nSG91cnNSZXN1bHQucm93c1swXSB8fCBudWxsXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgIGRhdGUsXG4gICAgICAgICAgYm9va2VkU2xvdHM6IG1hcHBlZEJvb2tlZFNsb3RzLFxuICAgICAgICAgIHdvcmtpbmdIb3VycyxcbiAgICAgICAgICBtZXNzYWdlOiAnQXZhaWxhYmxlIHRpbWUgc2xvdHMgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseSdcbiAgICAgICAgfSlcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGF2YWlsYWJsZSB0aW1lIHNsb3RzOicsIGVycm9yKVxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSxcbiAgICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICAgKVxuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaWYgKGRiKSB7XG4gICAgICAgICAgZGIucmVsZWFzZSgpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8g0JDQutC+INC90Y/QvNCwIGRhdGUg0L/QsNGA0LDQvNC10YLRitGALCDQstGA0YrRidCw0Lkg0LLRgdC40YfQutC4INGA0LXQt9C10YDQstCw0YbQuNC4XG4gICAgbGV0IGRiOiBQb29sQ2xpZW50IHwgbnVsbCA9IG51bGxcbiAgICBcbiAgICB0cnkge1xuICAgICAgZGIgPSBhd2FpdCBnZXREYXRhYmFzZSgpXG4gICAgICBjb25zdCBoYXNVc2VySWQgPSBhd2FpdCBlbnN1cmVIYXNVc2VySWRDb2x1bW4oZGIpXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5xdWVyeShcbiAgICAgICAgaGFzVXNlcklkXG4gICAgICAgICAgPyBgXG4gICAgICAgIFNFTEVDVCBiLiosIFxuICAgICAgICAgICAgICAgQ09BTEVTQ0Uocy5uYW1lLCBiLnNlcnZpY2U6OnRleHQpIGFzIHNlcnZpY2VOYW1lLCBcbiAgICAgICAgICAgICAgIENPQUxFU0NFKGIuc2VydmljZWR1cmF0aW9uLCBzLmR1cmF0aW9uLCAzMCkgYXMgc2VydmljZUR1cmF0aW9uLFxuICAgICAgICAgICAgICAgdS5pZCBhcyB1c2VySWQsXG4gICAgICAgICAgICAgICB1Lm5hbWUgYXMgdXNlck5hbWUsIFxuICAgICAgICAgICAgICAgdS5lbWFpbCBhcyB1c2VyRW1haWxcbiAgICAgICAgRlJPTSBib29raW5ncyBiXG4gICAgICAgIExFRlQgSk9JTiBzZXJ2aWNlcyBzIE9OIChcbiAgICAgICAgICBiLnNlcnZpY2U6OnRleHQgPSBzLmlkOjp0ZXh0IE9SIGIuc2VydmljZSA9IHMubmFtZVxuICAgICAgICApXG4gICAgICAgIExFRlQgSk9JTiB1c2VycyB1IE9OIChcbiAgICAgICAgICBiLnVzZXJfaWQgPSB1LmlkXG4gICAgICAgICAgT1IgKGIudXNlcl9pZCBJUyBOVUxMIEFORCBiLnBob25lIElTIE5PVCBOVUxMIEFORCB1LnBob25lIElTIE5PVCBOVUxMIEFORCByaWdodChyZWdleHBfcmVwbGFjZShiLnBob25lLCAnW14wLTldJywgJycsICdnJyksIDkpID0gcmlnaHQocmVnZXhwX3JlcGxhY2UodS5waG9uZSwgJ1teMC05XScsICcnLCAnZycpLCA5KSlcbiAgICAgICAgICBPUiAoYi51c2VyX2lkIElTIE5VTEwgQU5EIGIuZW1haWwgSVMgTk9UIE5VTEwgQU5EIHUuZW1haWwgSVMgTk9UIE5VTEwgQU5EIExPV0VSKGIuZW1haWwpID0gTE9XRVIodS5lbWFpbCkpXG4gICAgICAgICAgT1IgKFxuICAgICAgICAgICAgYi51c2VyX2lkIElTIE5VTEwgXG4gICAgICAgICAgICBBTkQgKGIucGhvbmUgSVMgTlVMTCBPUiBiLnBob25lID0gJycpIEFORCAodS5waG9uZSBJUyBOVUxMIE9SIHUucGhvbmUgPSAnJykgXG4gICAgICAgICAgICBBTkQgKGIuZW1haWwgSVMgTlVMTCBPUiBiLmVtYWlsID0gJycpIEFORCAodS5lbWFpbCBJUyBOVUxMIE9SIHUuZW1haWwgPSAnJykgXG4gICAgICAgICAgICBBTkQgTE9XRVIocmVnZXhwX3JlcGxhY2UodHJpbShiLm5hbWUpLCAnXFxcXHMrJywgJyAnLCAnZycpKSA9IExPV0VSKHJlZ2V4cF9yZXBsYWNlKHRyaW0odS5uYW1lKSwgJ1xcXFxzKycsICcgJywgJ2cnKSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgT1JERVIgQlkgYi5jcmVhdGVkYXQgREVTQ1xuICAgICAgYFxuICAgICAgICAgIDogYFxuICAgICAgICBTRUxFQ1QgYi4qLCBcbiAgICAgICAgICAgICAgIENPQUxFU0NFKHMubmFtZSwgYi5zZXJ2aWNlOjp0ZXh0KSBhcyBzZXJ2aWNlTmFtZSwgXG4gICAgICAgICAgICAgICBDT0FMRVNDRShiLnNlcnZpY2VkdXJhdGlvbiwgcy5kdXJhdGlvbiwgMzApIGFzIHNlcnZpY2VEdXJhdGlvbixcbiAgICAgICAgICAgICAgIHUuaWQgYXMgdXNlcklkLFxuICAgICAgICAgICAgICAgdS5uYW1lIGFzIHVzZXJOYW1lLCBcbiAgICAgICAgICAgICAgIHUuZW1haWwgYXMgdXNlckVtYWlsXG4gICAgICAgIEZST00gYm9va2luZ3MgYlxuICAgICAgICBMRUZUIEpPSU4gc2VydmljZXMgcyBPTiAoXG4gICAgICAgICAgYi5zZXJ2aWNlOjp0ZXh0ID0gcy5pZDo6dGV4dCBPUiBiLnNlcnZpY2UgPSBzLm5hbWVcbiAgICAgICAgKVxuICAgICAgICBMRUZUIEpPSU4gdXNlcnMgdSBPTiAoXG4gICAgICAgICAgKGIucGhvbmUgSVMgTk9UIE5VTEwgQU5EIHUucGhvbmUgSVMgTk9UIE5VTEwgQU5EIHJpZ2h0KHJlZ2V4cF9yZXBsYWNlKGIucGhvbmUsICdbXjAtOV0nLCAnJywgJ2cnKSwgOSkgPSByaWdodChyZWdleHBfcmVwbGFjZSh1LnBob25lLCAnW14wLTldJywgJycsICdnJyksIDkpKVxuICAgICAgICAgIE9SIChiLmVtYWlsIElTIE5PVCBOVUxMIEFORCB1LmVtYWlsIElTIE5PVCBOVUxMIEFORCBMT1dFUihiLmVtYWlsKSA9IExPV0VSKHUuZW1haWwpKVxuICAgICAgICAgIE9SICgoYi5waG9uZSBJUyBOVUxMIE9SIGIucGhvbmUgPSAnJykgQU5EICh1LnBob25lIElTIE5VTEwgT1IgdS5waG9uZSA9ICcnKSBBTkQgKGIuZW1haWwgSVMgTlVMTCBPUiBiLmVtYWlsID0gJycpIEFORCAodS5lbWFpbCBJUyBOVUxMIE9SIHUuZW1haWwgPSAnJykgQU5EIExPV0VSKGIubmFtZSkgPSBMT1dFUih1Lm5hbWUpKVxuICAgICAgICApXG4gICAgICAgIE9SREVSIEJZIGIuY3JlYXRlZGF0IERFU0NcbiAgICAgIGBcbiAgICAgIClcbiAgICAgIFxuICAgICAgLy8gTWFwIHNlcnZpY2VkdXJhdGlvbiB0byBzZXJ2aWNlRHVyYXRpb24gZm9yIGZyb250ZW5kIGNvbXBhdGliaWxpdHlcbiAgICAgIGNvbnN0IG1hcHBlZEJvb2tpbmdzID0gcmVzdWx0LnJvd3MubWFwKChib29raW5nOiB7IGlkPzogc3RyaW5nIHwgbnVtYmVyOyBzZXJ2aWNlZHVyYXRpb24/OiBudW1iZXI7IHNlcnZpY2VEdXJhdGlvbj86IG51bWJlcjsgY3JlYXRlZGF0Pzogc3RyaW5nOyBjcmVhdGVkQXQ/OiBzdHJpbmcgfSkgPT4ge1xuICAgICAgICBjb25zdCB7IHNlcnZpY2VkdXJhdGlvbiwgY3JlYXRlZGF0LCAuLi5yZXN0IH0gPSBib29raW5nXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGNyZWF0ZWRhdCB8fCBib29raW5nLmNyZWF0ZWRBdCxcbiAgICAgICAgICBzZXJ2aWNlRHVyYXRpb246IHNlcnZpY2VkdXJhdGlvbiB8fCBib29raW5nLnNlcnZpY2VEdXJhdGlvbiB8fCAzMFxuICAgICAgICB9XG4gICAgICB9KVxuXG4gICAgICAvLyBEZWR1cGxpY2F0ZSBieSBib29raW5nIGlkIHRvIGF2b2lkIGluZmxhdGVkIGNvdW50cyBkdWUgdG8gSk9JTnNcbiAgICAgIGNvbnN0IHVuaXF1ZUJ5SWQgPSBuZXcgTWFwPHN0cmluZywgKHR5cGVvZiBtYXBwZWRCb29raW5ncylbbnVtYmVyXT4oKVxuICAgICAgZm9yIChjb25zdCBiIG9mIG1hcHBlZEJvb2tpbmdzKSB7XG4gICAgICAgIGNvbnN0IGtleSA9IGIgJiYgKGIgYXMgdW5rbm93biBhcyB7IGlkPzogc3RyaW5nIHwgbnVtYmVyIH0pLmlkID8gU3RyaW5nKChiIGFzIHVua25vd24gYXMgeyBpZD86IHN0cmluZyB8IG51bWJlciB9KS5pZCkgOiBKU09OLnN0cmluZ2lmeShiKVxuICAgICAgICBpZiAoIXVuaXF1ZUJ5SWQuaGFzKGtleSkpIHtcbiAgICAgICAgICB1bmlxdWVCeUlkLnNldChrZXksIGIpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IHVuaXF1ZUJvb2tpbmdzID0gQXJyYXkuZnJvbSh1bmlxdWVCeUlkLnZhbHVlcygpKVxuICAgICAgXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBib29raW5nczogdW5pcXVlQm9va2luZ3MgfSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgYm9va2luZ3M6JywgZXJyb3IpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKVxuICAgIH0gZmluYWxseSB7XG4gICAgICBpZiAoZGIpIHtcbiAgICAgICAgZGIucmVsZWFzZSgpXG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGJvb2tpbmdzOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhZG1pblRva2VuID0gcmVxdWVzdC5oZWFkZXJzLmdldCgneC1hZG1pbi10b2tlbicpXG4gICAgXG4gICAgaWYgKCFhZG1pblRva2VuKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgIGNvbnN0IHsgbmFtZSwgZW1haWwsIHBob25lLCBzZXJ2aWNlLCBzZXJ2aWNlRHVyYXRpb24sIGRhdGUsIHRpbWUsIG1lc3NhZ2UgfSA9IGJvZHlcblxuICAgIC8vIEFkbWluIGNhbiBjcmVhdGUgYm9va2luZ3Mgd2l0aG91dCBwaG9uZSAtIG9ubHkgbmFtZSwgc2VydmljZSwgZGF0ZSwgdGltZSBhcmUgcmVxdWlyZWRcbiAgICBpZiAoIW5hbWUgfHwgIXNlcnZpY2UgfHwgIWRhdGUgfHwgIXRpbWUpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ01pc3NpbmcgcmVxdWlyZWQgZmllbGRzOiBuYW1lLCBzZXJ2aWNlLCBkYXRlLCB0aW1lJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG4gICAgXG4gICAgLy8gVmFsaWRhdGUgdGltZSBmb3JtYXRcbiAgICBjb25zdCB0aW1lUmVnZXggPSAvXihbMC0xXT9bMC05XXwyWzAtM10pOlswLTVdWzAtOV0kL1xuICAgIGlmICghdGltZVJlZ2V4LnRlc3QodGltZSkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0ludmFsaWQgdGltZSBmb3JtYXQuIFBsZWFzZSB1c2UgSEg6TU0gZm9ybWF0IChlLmcuLCAxNDozMCknIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICAvLyBWYWxpZGF0ZSBkYXRlIGZvcm1hdFxuICAgIGNvbnN0IGRhdGVSZWdleCA9IC9eXFxkezR9LVxcZHsyfS1cXGR7Mn0kL1xuICAgIGlmICghZGF0ZVJlZ2V4LnRlc3QoZGF0ZSkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0ludmFsaWQgZGF0ZSBmb3JtYXQuIFBsZWFzZSB1c2UgWVlZWS1NTS1ERCBmb3JtYXQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGF0YWJhc2UoKVxuICAgIFxuICAgIC8vINCQ0LLRgtC+0LzQsNGC0LjRh9C90L4g0YHRitC30LTQsNCy0LDQvdC1INC90LAg0L/QvtGC0YDQtdCx0LjRgtC10Lsg0LDQutC+IHBob25lINC1INC/0YDQtdC00L7RgdGC0LDQstC10L1cbiAgICBpZiAocGhvbmUgJiYgcGhvbmUudHJpbSgpKSB7XG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGV4aXN0cyBieSBwaG9uZSBudW1iZXJcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi5xdWVyeSgnU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBwaG9uZSA9ICQxJywgW3Bob25lLnRyaW0oKV0pXG4gICAgICBcbiAgICAgIGlmICh1c2VyLnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIC8vIENyZWF0ZSBuZXcgdXNlclxuICAgICAgICBhd2FpdCBkYi5xdWVyeShgXG4gICAgICAgICAgSU5TRVJUIElOVE8gdXNlcnMgKG5hbWUsIGVtYWlsLCBwaG9uZSlcbiAgICAgICAgICBWQUxVRVMgKCQxLCAkMiwgJDMpXG4gICAgICAgICAgUkVUVVJOSU5HIGlkXG4gICAgICAgIGAsIFtuYW1lLCBlbWFpbCB8fCBudWxsLCBwaG9uZS50cmltKCldKVxuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBDcmVhdGVkIG5ldyB1c2VyIGZvciBwaG9uZTogJHtwaG9uZS50cmltKCl9YClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyB1c2VyJ3MgaW5mb3JtYXRpb24gaWYgbmVlZGVkXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IHVzZXIucm93c1swXVxuICAgICAgICBpZiAoZXhpc3RpbmdVc2VyLm5hbWUgIT09IG5hbWUgfHwgZXhpc3RpbmdVc2VyLmVtYWlsICE9PSBlbWFpbCkge1xuICAgICAgICAgIGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICAgICAgICAgIFVQREFURSB1c2VycyBcbiAgICAgICAgICAgIFNFVCBuYW1lID0gJDEsIGVtYWlsID0gJDIsIHVwZGF0ZWRBdCA9IENVUlJFTlRfVElNRVNUQU1QXG4gICAgICAgICAgICBXSEVSRSBpZCA9ICQzXG4gICAgICAgICAgYCwgW25hbWUsIGVtYWlsIHx8IG51bGwsIGV4aXN0aW5nVXNlci5pZF0pXG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coYOKchSBVcGRhdGVkIGV4aXN0aW5nIHVzZXIgZm9yIHBob25lOiAke3Bob25lLnRyaW0oKX1gKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vINCf0YDQvtCy0LXRgNC4INC00LDQu9C4INGH0LDRgdGK0YIg0LUg0YHQstC+0LHQvtC00LXQvVxuICAgIGNvbnN0IGF2YWlsYWJpbGl0eUNoZWNrID0gYXdhaXQgY2hlY2tUaW1lU2xvdEF2YWlsYWJpbGl0eShkYiwgZGF0ZSwgdGltZSwgcGFyc2VJbnQoc2VydmljZSksIHNlcnZpY2VEdXJhdGlvbilcbiAgICBcbiAgICBpZiAoIWF2YWlsYWJpbGl0eUNoZWNrLmF2YWlsYWJsZSkge1xuICAgICAgZGIucmVsZWFzZSgpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IGF2YWlsYWJpbGl0eUNoZWNrLmVycm9yIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDkgfSAvLyBDb25mbGljdFxuICAgICAgKVxuICAgIH1cbiAgICBcbiAgICAvLyBJbnNlcnQgbmV3IGJvb2tpbmcgKHBob25lIGNhbiBiZSBudWxsIGZvciBhZG1pbiBib29raW5ncylcbiAgICAvLyBUcnkgdG8gcmVzb2x2ZSB1c2VyX2lkIHdoZW4gcG9zc2libGUgYnkgcGhvbmUvZW1haWwvbmFtZVxuICAgIGxldCByZXNvbHZlZFVzZXJJZDogbnVtYmVyIHwgbnVsbCA9IG51bGxcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlckxvb2t1cCA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICAgICAgU0VMRUNUIGlkIEZST00gdXNlcnMgXG4gICAgICAgIFdIRVJFIChcbiAgICAgICAgICAoJDEgSVMgTk9UIE5VTEwgQU5EICQxIDw+ICcnIEFORCBwaG9uZSBJUyBOT1QgTlVMTCBBTkQgcmlnaHQocmVnZXhwX3JlcGxhY2UocGhvbmUsICdbXjAtOV0nLCAnJywgJ2cnKSwgOSkgPSByaWdodChyZWdleHBfcmVwbGFjZSgkMSwgJ1teMC05XScsICcnLCAnZycpLCA5KSlcbiAgICAgICAgKSBPUiAoXG4gICAgICAgICAgKCQyIElTIE5PVCBOVUxMIEFORCAkMiA8PiAnJyBBTkQgZW1haWwgSVMgTk9UIE5VTEwgQU5EIExPV0VSKGVtYWlsKSA9IExPV0VSKCQyKSlcbiAgICAgICAgKSBPUiAoXG4gICAgICAgICAgKCQxIElTIE5VTEwgT1IgJDEgPSAnJykgQU5EICgkMiBJUyBOVUxMIE9SICQyID0gJycpIEFORCBMT1dFUihuYW1lKSA9IExPV0VSKCQzKVxuICAgICAgICApXG4gICAgICAgIExJTUlUIDFcbiAgICAgIGAsIFtwaG9uZSB8fCBudWxsLCBlbWFpbCB8fCBudWxsLCBuYW1lXSlcbiAgICAgIGlmICh1c2VyTG9va3VwLnJvd3NbMF0pIHtcbiAgICAgICAgcmVzb2x2ZWRVc2VySWQgPSB1c2VyTG9va3VwLnJvd3NbMF0uaWRcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1VzZXIgbG9va3VwIGZhaWxlZCwgcHJvY2VlZGluZyB3aXRob3V0IHVzZXJfaWQnKVxuICAgIH1cblxuICAgIGNvbnN0IGhhc1VzZXJJZCA9IGF3YWl0IGVuc3VyZUhhc1VzZXJJZENvbHVtbihkYilcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5xdWVyeShcbiAgICAgIGhhc1VzZXJJZFxuICAgICAgICA/IGBcbiAgICAgIElOU0VSVCBJTlRPIGJvb2tpbmdzIChuYW1lLCBlbWFpbCwgcGhvbmUsIHNlcnZpY2UsIHNlcnZpY2VkdXJhdGlvbiwgZGF0ZSwgdGltZSwgbWVzc2FnZSwgc3RhdHVzLCBjcmVhdGVkYXQsIHVzZXJfaWQpXG4gICAgICBWQUxVRVMgKCQxLCAkMiwgJDMsICQ0LCAkNSwgJDYsICQ3LCAkOCwgJDksIENVUlJFTlRfVElNRVNUQU1QLCAkMTApXG4gICAgICBSRVRVUk5JTkcgaWQsIGNyZWF0ZWRhdFxuICAgIGBcbiAgICAgICAgOiBgXG4gICAgICBJTlNFUlQgSU5UTyBib29raW5ncyAobmFtZSwgZW1haWwsIHBob25lLCBzZXJ2aWNlLCBzZXJ2aWNlZHVyYXRpb24sIGRhdGUsIHRpbWUsIG1lc3NhZ2UsIHN0YXR1cywgY3JlYXRlZGF0KVxuICAgICAgVkFMVUVTICgkMSwgJDIsICQzLCAkNCwgJDUsICQ2LCAkNywgJDgsICQ5LCBDVVJSRU5UX1RJTUVTVEFNUClcbiAgICAgIFJFVFVSTklORyBpZCwgY3JlYXRlZGF0XG4gICAgYCxcbiAgICAgIGhhc1VzZXJJZFxuICAgICAgICA/IFtuYW1lLCBlbWFpbCB8fCBudWxsLCBwaG9uZSB8fCBudWxsLCBwYXJzZUludChzZXJ2aWNlKSwgc2VydmljZUR1cmF0aW9uIHx8IDMwLCBkYXRlLCB0aW1lLCBtZXNzYWdlIHx8IG51bGwsICdwZW5kaW5nJywgcmVzb2x2ZWRVc2VySWRdXG4gICAgICAgIDogW25hbWUsIGVtYWlsIHx8IG51bGwsIHBob25lIHx8IG51bGwsIHBhcnNlSW50KHNlcnZpY2UpLCBzZXJ2aWNlRHVyYXRpb24gfHwgMzAsIGRhdGUsIHRpbWUsIG1lc3NhZ2UgfHwgbnVsbCwgJ3BlbmRpbmcnXVxuICAgIClcblxuICAgIGNvbnN0IG5ld0Jvb2tpbmdJZCA9IHJlc3VsdC5yb3dzWzBdLmlkXG4gICAgY29uc3QgbmV3Q3JlYXRlZEF0ID0gcmVzdWx0LnJvd3NbMF0uY3JlYXRlZGF0XG4gICAgY29uc3QgbmV3Qm9va2luZyA9IHtcbiAgICAgIGlkOiBuZXdCb29raW5nSWQsXG4gICAgICBuYW1lLFxuICAgICAgZW1haWwsXG4gICAgICBwaG9uZSxcbiAgICAgIHVzZXJJZDogaGFzVXNlcklkID8gKHJlc29sdmVkVXNlcklkIHx8IHVuZGVmaW5lZCkgOiB1bmRlZmluZWQsXG4gICAgICBzZXJ2aWNlLFxuICAgICAgc2VydmljZUR1cmF0aW9uOiBzZXJ2aWNlRHVyYXRpb24gfHwgMzAsXG4gICAgICBkYXRlLFxuICAgICAgdGltZSxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgIGNyZWF0ZWRBdDogbmV3Q3JlYXRlZEF0XG4gICAgfVxuXG4gICAgZGIucmVsZWFzZSgpXG4gICAgXG4gICAgLy8gRW1pdCBXZWJTb2NrZXQgZXZlbnQgZm9yIHJlYWwtdGltZSB1cGRhdGVzXG4gICAgdHJ5IHtcbiAgICAgIC8vIEVucmljaCB3aXRoIHNlcnZpY2VOYW1lIGZvciBpbW1lZGlhdGUgVUkgZGlzcGxheVxuICAgICAgY29uc3Qgc3ZjID0gYXdhaXQgZGIucXVlcnkoJ1NFTEVDVCBuYW1lIEZST00gc2VydmljZXMgV0hFUkUgaWQ6OnRleHQgPSAkMSBPUiBuYW1lID0gJDEnLCBbU3RyaW5nKHNlcnZpY2UpXSlcbiAgICAgIGNvbnN0IGVucmljaGVkID0geyAuLi5uZXdCb29raW5nLCBzZXJ2aWNlTmFtZTogc3ZjLnJvd3NbMF0/Lm5hbWUgfHwgU3RyaW5nKHNlcnZpY2UpIH1cbiAgICAgIGVtaXRCb29raW5nQWRkZWQoZW5yaWNoZWQgYXMgdW5rbm93bilcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IGVtaXQgZXJyb3I6JywgZXJyb3IpXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBtZXNzYWdlOiAnQm9va2luZyBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICBpZDogbmV3Qm9va2luZ0lkXG4gICAgfSlcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBib29raW5nOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBVVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGFkbWluVG9rZW4gPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWFkbWluLXRva2VuJylcbiAgICBpZiAoIWFkbWluVG9rZW4pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApXG4gICAgfVxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgIGNvbnNvbGUubG9nKCfwn5SNIFtQVVQgQm9va2luZ3NdIFJlcXVlc3QgYm9keTonLCBib2R5KVxuICAgIGNvbnN0IHsgaWQsIHN0YXR1cywgdHJlYXRtZW50X25vdGVzLCAuLi5vdGhlckZpZWxkcyB9ID0gYm9keVxuICAgIGNvbnNvbGUubG9nKCfwn5SNIFtQVVQgQm9va2luZ3NdIEV4dHJhY3RlZCBkYXRhOicsIHsgaWQsIHN0YXR1cywgdHJlYXRtZW50X25vdGVzLCBvdGhlckZpZWxkcyB9KVxuICAgIGlmICghaWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0Jvb2tpbmcgSUQgaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cbiAgICBjb25zdCBkYiA9IGF3YWl0IGdldERhdGFiYXNlKClcbiAgICBcbiAgICAvLyBDaGVjayBpZiB0aGlzIGlzIGEgc3RhdHVzLW9ubHkgdXBkYXRlXG4gICAgY29uc3QgaGFzU3RhdHVzT25seSA9IHN0YXR1cyAhPT0gdW5kZWZpbmVkICYmIE9iamVjdC5rZXlzKG90aGVyRmllbGRzKS5sZW5ndGggPT09IDBcbiAgICBjb25zdCBoYXNUcmVhdG1lbnROb3Rlc09ubHkgPSB0cmVhdG1lbnRfbm90ZXMgIT09IHVuZGVmaW5lZCAmJiBPYmplY3Qua2V5cyhvdGhlckZpZWxkcykubGVuZ3RoID09PSAwXG4gICAgXG5cbiAgICBcbiAgICBpZiAoaGFzU3RhdHVzT25seSkge1xuICAgICAgYXdhaXQgZGIucXVlcnkoJ1VQREFURSBib29raW5ncyBTRVQgc3RhdHVzID0gJDEgV0hFUkUgaWQgPSAkMicsIFtzdGF0dXMsIGlkXSlcbiAgICB9IGVsc2UgaWYgKGhhc1RyZWF0bWVudE5vdGVzT25seSkge1xuICAgICAgYXdhaXQgZGIucXVlcnkoJ1VQREFURSBib29raW5ncyBTRVQgdHJlYXRtZW50X25vdGVzID0gJDEgV0hFUkUgaWQgPSAkMicsIFt0cmVhdG1lbnRfbm90ZXMsIGlkXSlcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVXBkYXRlIGJvb2tpbmcgZGV0YWlscyAobmFtZSwgZW1haWwsIHBob25lLCBzZXJ2aWNlLCBldGMuKVxuICAgICAgY29uc3QgeyBuYW1lLCBlbWFpbCwgcGhvbmUsIHNlcnZpY2UsIHNlcnZpY2VEdXJhdGlvbiwgZGF0ZSwgdGltZSwgbWVzc2FnZSB9ID0gb3RoZXJGaWVsZHNcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFtQVVQgQm9va2luZ3NdIFVwZGF0ZSBib29raW5nIGRldGFpbHM6JywgeyBuYW1lLCBlbWFpbCwgcGhvbmUsIHNlcnZpY2UsIHNlcnZpY2VEdXJhdGlvbiwgZGF0ZSwgdGltZSwgbWVzc2FnZSB9KVxuICAgICAgXG4gICAgICBpZiAoZGF0ZSAmJiB0aW1lICYmIHNlcnZpY2UpIHtcbiAgICAgICAgY29uc3QgYXZhaWxhYmlsaXR5Q2hlY2sgPSBhd2FpdCBjaGVja1RpbWVTbG90QXZhaWxhYmlsaXR5KGRiLCBkYXRlLCB0aW1lLCBwYXJzZUludChzZXJ2aWNlKSwgc2VydmljZUR1cmF0aW9uLCBwYXJzZUludChpZCkpXG4gICAgICAgIGlmICghYXZhaWxhYmlsaXR5Q2hlY2suYXZhaWxhYmxlKSB7XG4gICAgICAgICAgZGIucmVsZWFzZSgpXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgeyBlcnJvcjogYXZhaWxhYmlsaXR5Q2hlY2suZXJyb3IgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA0MDkgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBbUFVUIEJvb2tpbmdzXSBTUUwgVXBkYXRlIHBhcmFtczonLCBbbmFtZSwgZW1haWwgfHwgbnVsbCwgcGhvbmUsIHNlcnZpY2UsIHNlcnZpY2VEdXJhdGlvbiB8fCAzMCwgZGF0ZSwgdGltZSwgbWVzc2FnZSB8fCBudWxsLCBzdGF0dXMgfHwgJ3BlbmRpbmcnLCBpZF0pXG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgICAgICAgVVBEQVRFIGJvb2tpbmdzXG4gICAgICAgIFNFVCBuYW1lID0gJDEsIGVtYWlsID0gJDIsIHBob25lID0gJDMsIHNlcnZpY2UgPSAkNCwgc2VydmljZWR1cmF0aW9uID0gJDUsIGRhdGUgPSAkNiwgdGltZSA9ICQ3LCBtZXNzYWdlID0gJDgsIHN0YXR1cyA9ICQ5XG4gICAgICAgIFdIRVJFIGlkID0gJDEwXG4gICAgICBgLCBbbmFtZSwgZW1haWwgfHwgbnVsbCwgcGhvbmUsIHNlcnZpY2UsIHNlcnZpY2VEdXJhdGlvbiB8fCAzMCwgZGF0ZSwgdGltZSwgbWVzc2FnZSB8fCBudWxsLCBzdGF0dXMgfHwgJ3BlbmRpbmcnLCBpZF0pXG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFtQVVQgQm9va2luZ3NdIFNRTCBVcGRhdGUgcmVzdWx0OicsIHJlc3VsdC5yb3dDb3VudClcbiAgICB9XG4gICAgZGIucmVsZWFzZSgpXG4gICAgXG4gICAgLy8gR2V0IHRoZSB1cGRhdGVkIGJvb2tpbmcgZm9yIFdlYlNvY2tldCBldmVudFxuICAgIGNvbnN0IHVwZGF0ZWRCb29raW5nID0gYXdhaXQgZGIucXVlcnkoYFxuICAgICAgU0VMRUNUIGIuKiwgXG4gICAgICAgICAgICAgQ09BTEVTQ0Uocy5uYW1lLCBiLnNlcnZpY2U6OnRleHQpIGFzIHNlcnZpY2VOYW1lLFxuICAgICAgICAgICAgIENPQUxFU0NFKGIuc2VydmljZWR1cmF0aW9uLCBzLmR1cmF0aW9uLCAzMCkgYXMgc2VydmljZUR1cmF0aW9uLFxuICAgICAgICAgICAgIHUubmFtZSBhcyB1c2VyTmFtZSwgXG4gICAgICAgICAgICAgdS5lbWFpbCBhcyB1c2VyRW1haWxcbiAgICAgIEZST00gYm9va2luZ3MgYlxuICAgICAgTEVGVCBKT0lOIHNlcnZpY2VzIHMgT04gKFxuICAgICAgICBiLnNlcnZpY2U6OnRleHQgPSBzLmlkOjp0ZXh0IE9SIGIuc2VydmljZSA9IHMubmFtZVxuICAgICAgKVxuICAgICAgTEVGVCBKT0lOIHVzZXJzIHUgT04gYi5waG9uZSA9IHUucGhvbmVcbiAgICAgIFdIRVJFIGIuaWQgPSAkMVxuICAgIGAsIFtpZF0pXG5cbiAgICBjb25zdCBtYXBwZWQgPSAoKCkgPT4ge1xuICAgICAgY29uc3Qgcm93ID0gdXBkYXRlZEJvb2tpbmcucm93c1swXSBhcyB7IHNlcnZpY2VkdXJhdGlvbj86IG51bWJlcjsgY3JlYXRlZGF0Pzogc3RyaW5nOyBjcmVhdGVkQXQ/OiBzdHJpbmcgfSB8IHVuZGVmaW5lZFxuICAgICAgaWYgKCFyb3cpIHJldHVybiBudWxsXG4gICAgICBjb25zdCB7IHNlcnZpY2VkdXJhdGlvbiwgY3JlYXRlZGF0LCAuLi5yZXN0IH0gPSByb3cgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbiAgICAgIHJldHVybiB7IFxuICAgICAgICAuLi4ocmVzdCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiksIFxuICAgICAgICBjcmVhdGVkQXQ6IGNyZWF0ZWRhdCB8fCByb3cuY3JlYXRlZEF0LCBcbiAgICAgICAgc2VydmljZUR1cmF0aW9uOiBzZXJ2aWNlZHVyYXRpb24gfHwgKHJvdyBhcyB1bmtub3duIGFzIHsgc2VydmljZUR1cmF0aW9uPzogbnVtYmVyIH0pLnNlcnZpY2VEdXJhdGlvbiB8fCAzMCBcbiAgICAgIH1cbiAgICB9KSgpXG5cbiAgICB0cnkge1xuICAgICAgaWYgKG1hcHBlZCkgZW1pdEJvb2tpbmdVcGRhdGUobWFwcGVkKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdXZWJTb2NrZXQgZW1pdCBlcnJvcjonLCBlcnJvcilcbiAgICB9XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIG1lc3NhZ2U6ICdCb29raW5nIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIGJvb2tpbmc6IG1hcHBlZFxuICAgIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgYm9va2luZzonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhZG1pblRva2VuID0gcmVxdWVzdC5oZWFkZXJzLmdldCgneC1hZG1pbi10b2tlbicpXG4gICAgXG4gICAgaWYgKCFhZG1pblRva2VuKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKVxuICAgIGNvbnN0IGlkID0gc2VhcmNoUGFyYW1zLmdldCgnaWQnKVxuXG4gICAgaWYgKCFpZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnQm9va2luZyBJRCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYXRhYmFzZSgpXG4gICAgYXdhaXQgZGIucXVlcnkoJ0RFTEVURSBGUk9NIGJvb2tpbmdzIFdIRVJFIGlkID0gJDEnLCBbaWRdKVxuXG4gICAgZGIucmVsZWFzZSgpXG4gICAgXG4gICAgLy8gRW1pdCBXZWJTb2NrZXQgZXZlbnQgZm9yIHJlYWwtdGltZSB1cGRhdGVzXG4gICAgdHJ5IHtcbiAgICAgIGVtaXRCb29raW5nRGVsZXRlZChpZClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignV2ViU29ja2V0IGVtaXQgZXJyb3I6JywgZXJyb3IpXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBtZXNzYWdlOiAnQm9va2luZyBkZWxldGVkIHN1Y2Nlc3NmdWxseSdcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRlbGV0aW5nIGJvb2tpbmc6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufSAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0RGF0YWJhc2UiLCJlbWl0Qm9va2luZ0FkZGVkIiwiZW1pdEJvb2tpbmdEZWxldGVkIiwiZW1pdEJvb2tpbmdVcGRhdGUiLCJhcGlSZXF1ZXN0Q291bnRlciIsImhhc1VzZXJJZENvbHVtbkNhY2hlIiwiZW5zdXJlSGFzVXNlcklkQ29sdW1uIiwiZGIiLCJyZXMiLCJxdWVyeSIsInJvd3MiLCJsZW5ndGgiLCJjaGVja1RpbWVTbG90QXZhaWxhYmlsaXR5IiwiZGF0ZSIsInRpbWUiLCJzZXJ2aWNlSWQiLCJkdXJhdGlvbiIsImV4Y2x1ZGVCb29raW5nSWQiLCJzZXJ2aWNlUmVzdWx0Iiwicm93Q291bnQiLCJhdmFpbGFibGUiLCJlcnJvciIsInNlcnZpY2VEdXJhdGlvbiIsImhvdXJzIiwibWludXRlcyIsInNwbGl0IiwibWFwIiwiTnVtYmVyIiwic3RhcnRUaW1lTWludXRlcyIsImVuZFRpbWVNaW51dGVzIiwiYnJlYWtzUmVzdWx0IiwiYnJlYWtJdGVtIiwiYnJlYWtTdGFydEhvdXIiLCJicmVha1N0YXJ0TWludXRlIiwic3RhcnRfdGltZSIsImJyZWFrRW5kSG91ciIsImJyZWFrRW5kTWludXRlIiwiZW5kX3RpbWUiLCJicmVha1N0YXJ0TWludXRlcyIsImJyZWFrRW5kTWludXRlcyIsImV4aXN0aW5nQm9va2luZ3NRdWVyeSIsImV4aXN0aW5nQm9va2luZ3NQYXJhbXMiLCJleGlzdGluZ0Jvb2tpbmdzIiwiYm9va2luZyIsImJvb2tpbmdIb3VycyIsImJvb2tpbmdNaW51dGVzIiwiYm9va2luZ1N0YXJ0TWludXRlcyIsImJvb2tpbmdEdXJhdGlvbiIsInNlcnZpY2VkdXJhdGlvbiIsImJvb2tpbmdFbmRNaW51dGVzIiwiY29uc29sZSIsIkdFVCIsInJlcXVlc3QiLCJsb2ciLCJhZG1pblRva2VuIiwiaGVhZGVycyIsImdldCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsImlkIiwiY2FsbE51bWJlciIsImhhc0RhdGUiLCJoYXNJZCIsInVzZXJBZ2VudCIsInN1YnN0cmluZyIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImpzb24iLCJzdGF0dXMiLCJib29raW5nc1Jlc3VsdCIsIndvcmtpbmdIb3Vyc1Jlc3VsdCIsIm1hcHBlZEJvb2tlZFNsb3RzIiwic2xvdCIsInJlc3QiLCJ3b3JraW5nSG91cnMiLCJib29rZWRTbG90cyIsIm1lc3NhZ2UiLCJyZWxlYXNlIiwiaGFzVXNlcklkIiwicmVzdWx0IiwibWFwcGVkQm9va2luZ3MiLCJjcmVhdGVkYXQiLCJjcmVhdGVkQXQiLCJ1bmlxdWVCeUlkIiwiTWFwIiwiYiIsImtleSIsIlN0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJoYXMiLCJzZXQiLCJ1bmlxdWVCb29raW5ncyIsIkFycmF5IiwiZnJvbSIsInZhbHVlcyIsImJvb2tpbmdzIiwiUE9TVCIsImJvZHkiLCJuYW1lIiwiZW1haWwiLCJwaG9uZSIsInNlcnZpY2UiLCJ0aW1lUmVnZXgiLCJ0ZXN0IiwiZGF0ZVJlZ2V4IiwidHJpbSIsInVzZXIiLCJleGlzdGluZ1VzZXIiLCJhdmFpbGFiaWxpdHlDaGVjayIsInBhcnNlSW50IiwicmVzb2x2ZWRVc2VySWQiLCJ1c2VyTG9va3VwIiwiZSIsIndhcm4iLCJuZXdCb29raW5nSWQiLCJuZXdDcmVhdGVkQXQiLCJuZXdCb29raW5nIiwidXNlcklkIiwidW5kZWZpbmVkIiwic3ZjIiwiZW5yaWNoZWQiLCJzZXJ2aWNlTmFtZSIsIlBVVCIsInRyZWF0bWVudF9ub3RlcyIsIm90aGVyRmllbGRzIiwiaGFzU3RhdHVzT25seSIsIk9iamVjdCIsImtleXMiLCJoYXNUcmVhdG1lbnROb3Rlc09ubHkiLCJ1cGRhdGVkQm9va2luZyIsIm1hcHBlZCIsInJvdyIsIkRFTEVURSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/admin/bookings/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/database.ts":
/*!*****************************!*\
  !*** ./src/lib/database.ts ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   closeDatabase: () => (/* binding */ closeDatabase),\n/* harmony export */   convertQuery: () => (/* binding */ convertQuery),\n/* harmony export */   getDatabase: () => (/* binding */ getDatabase),\n/* harmony export */   getPoolStatus: () => (/* binding */ getPoolStatus),\n/* harmony export */   logDatabaseError: () => (/* binding */ logDatabaseError)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_0__]);\npg__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nlet pool = null;\nasync function getDatabase() {\n    if (!pool) {\n        pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n            host: process.env.DB_HOST || \"192.168.1.134\",\n            port: parseInt(process.env.DB_PORT || \"5432\"),\n            database: process.env.DB_NAME || \"drborislavpetrov\",\n            user: process.env.DB_USER || \"drborislavpetrov\",\n            password: process.env.DB_PASSWORD || \"Xander123)(*\",\n            max: 30,\n            min: 2,\n            idleTimeoutMillis: 60000,\n            connectionTimeoutMillis: 30000\n        });\n        // Добавяме error handling за pool\n        pool.on(\"error\", (err)=>{\n            console.error(\"❌ Unexpected error on idle client\", err);\n        });\n        pool.on(\"connect\", ()=>{\n            console.log(\"✅ New database connection established\");\n        });\n    }\n    try {\n        const client = await pool.connect();\n        // Create tables if they don't exist\n        await createTablesIfNotExist(client);\n        return client;\n    } catch (error) {\n        console.error(\"❌ Error connecting to database:\", error);\n        // Retry logic\n        if (pool) {\n            console.log(\"\\uD83D\\uDD04 Attempting to recreate pool...\");\n            await pool.end();\n            pool = null;\n            // Wait a bit before retrying\n            await new Promise((resolve)=>setTimeout(resolve, 1000));\n            // Recursive call to recreate pool\n            return getDatabase();\n        }\n        throw error;\n    }\n}\nasync function createTablesIfNotExist(client) {\n    try {\n        // Create bookings table\n        await client.query(`\n      CREATE TABLE IF NOT EXISTS bookings (\n        id SERIAL PRIMARY KEY,\n        name TEXT NOT NULL,\n        email TEXT,\n        phone TEXT,\n        service TEXT NOT NULL,\n        serviceduration INTEGER DEFAULT 30,\n        date TEXT NOT NULL,\n        time TEXT NOT NULL,\n        message TEXT,\n        status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'confirmed', 'cancelled')),\n        treatment_notes TEXT,\n        createdat TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n        // Create users table with phone as unique identifier (but allowing NULL for admin users)\n        await client.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id SERIAL PRIMARY KEY,\n        name TEXT NOT NULL,\n        email TEXT,\n        phone TEXT UNIQUE NULL,\n        address TEXT,\n        notes TEXT,\n        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n        // Alter existing table to allow NULL values for phone (if constraint exists)\n        try {\n            await client.query(`\n        ALTER TABLE users \n        ALTER COLUMN phone DROP NOT NULL\n      `);\n        } catch (error) {\n            // Column might already allow NULL or constraint doesn't exist\n            console.log(\"Phone column already allows NULL or constraint not found\");\n        }\n        // Create services table\n        await client.query(`\n      CREATE TABLE IF NOT EXISTS services (\n        id SERIAL PRIMARY KEY,\n        name TEXT NOT NULL,\n        description TEXT,\n        duration INTEGER NOT NULL DEFAULT 30,\n        price REAL,\n        isActive BOOLEAN DEFAULT true,\n        createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n        // Create working hours table\n        await client.query(`\n      CREATE TABLE IF NOT EXISTS working_hours (\n        id SERIAL PRIMARY KEY,\n        date TEXT NOT NULL UNIQUE,\n        is_working_day BOOLEAN DEFAULT true,\n        start_time TEXT DEFAULT '09:00',\n        end_time TEXT DEFAULT '18:00',\n        notes TEXT,\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n        // Create breaks table for multiple breaks per day\n        await client.query(`\n      CREATE TABLE IF NOT EXISTS working_breaks (\n        id SERIAL PRIMARY KEY,\n        working_hours_id INTEGER REFERENCES working_hours(id) ON DELETE CASCADE,\n        start_time TEXT NOT NULL,\n        end_time TEXT NOT NULL,\n        description TEXT DEFAULT 'Почивка',\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n        // Create bug tracking tables\n        await client.query(`\n      CREATE TABLE IF NOT EXISTS bug_reports (\n        id SERIAL PRIMARY KEY,\n        title TEXT NOT NULL,\n        description TEXT NOT NULL,\n        severity TEXT CHECK (severity IN ('low', 'medium', 'high', 'critical')),\n        status TEXT DEFAULT 'open' CHECK (status IN ('open', 'in-progress', 'resolved', 'closed')),\n        category TEXT CHECK (category IN ('ui', 'functionality', 'performance', 'security', 'database')),\n        priority TEXT DEFAULT 'medium' CHECK (priority IN ('low', 'medium', 'high', 'urgent')),\n        reporter TEXT NOT NULL,\n        assigned_to TEXT,\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        steps_to_reproduce TEXT[],\n        expected_behavior TEXT,\n        actual_behavior TEXT,\n        browser TEXT,\n        device TEXT,\n        screenshots TEXT[],\n        tags TEXT[]\n      )\n    `);\n        await client.query(`\n      CREATE TABLE IF NOT EXISTS bug_comments (\n        id SERIAL PRIMARY KEY,\n        bug_id INTEGER REFERENCES bug_reports(id) ON DELETE CASCADE,\n        author TEXT NOT NULL,\n        content TEXT NOT NULL,\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        is_internal BOOLEAN DEFAULT false\n      )\n    `);\n        await client.query(`\n      CREATE TABLE IF NOT EXISTS bug_attachments (\n        id SERIAL PRIMARY KEY,\n        bug_id INTEGER REFERENCES bug_reports(id) ON DELETE CASCADE,\n        filename TEXT NOT NULL,\n        url TEXT NOT NULL,\n        size INTEGER NOT NULL,\n        uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n        // Insert default services if table is empty\n        const servicesCount = await client.query(\"SELECT COUNT(*) as count FROM services\");\n        if (parseInt(servicesCount.rows[0].count) === 0) {\n            await client.query(`\n        INSERT INTO services (name, description, duration, price) VALUES\n        ('Преглед и консултация', 'Основен преглед на зъбите и консултация', 30, 50.00),\n        ('Почистване и профилактика', 'Професионално почистване на зъбен камък', 45, 80.00),\n        ('Лечение на кариес', 'Лечение на кариес с модерни материали', 60, 120.00),\n        ('Отбелязване', 'Професионално отбелязване на зъбите', 90, 200.00),\n        ('Ортодонтия', 'Консултация за ортодонтски лечение', 45, 100.00)\n      `);\n        }\n    } catch (error) {\n        console.error(\"Error creating tables:\", error);\n        throw error;\n    }\n}\nasync function closeDatabase() {\n    if (pool) {\n        await pool.end();\n        pool = null;\n    }\n}\n// Database pool monitoring function\nfunction getPoolStatus() {\n    if (!pool) return null;\n    return {\n        totalCount: pool.totalCount,\n        idleCount: pool.idleCount,\n        waitingCount: pool.waitingCount\n    };\n}\n// Enhanced error logging\nfunction logDatabaseError(error, operation) {\n    const err = error;\n    console.error(`❌ Database error in ${operation}:`, {\n        message: err?.message,\n        code: err?.code,\n        detail: err?.detail,\n        hint: err?.hint,\n        where: err?.where,\n        stack: err?.stack\n    });\n}\n// Helper function to convert SQLite-style queries to PostgreSQL\nfunction convertQuery(sqliteQuery) {\n    // Replace SQLite-specific syntax with PostgreSQL syntax\n    return sqliteQuery.replace(/DATETIME DEFAULT CURRENT_TIMESTAMP/g, \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\").replace(/BOOLEAN DEFAULT 1/g, \"BOOLEAN DEFAULT true\").replace(/BOOLEAN DEFAULT 0/g, \"BOOLEAN DEFAULT false\").replace(/datetime\\('now', '-7 days'\\)/g, \"CURRENT_TIMESTAMP - INTERVAL '7 days'\").replace(/DATE\\(/g, \"DATE(\");\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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MEJBO1FBQ3hDLE1BQU1BO0lBQ1I7QUFDRjtBQUVPLGVBQWVhO0lBQ3BCLElBQUluQyxNQUFNO1FBQ1IsTUFBTUEsS0FBSzJCLEdBQUc7UUFDZDNCLE9BQU87SUFDVDtBQUNGO0FBRUEsb0NBQW9DO0FBQzdCLFNBQVNvQztJQUNkLElBQUksQ0FBQ3BDLE1BQU0sT0FBTztJQUNsQixPQUFPO1FBQ0xxQyxZQUFZckMsS0FBS3FDLFVBQVU7UUFDM0JDLFdBQVd0QyxLQUFLc0MsU0FBUztRQUN6QkMsY0FBY3ZDLEtBQUt1QyxZQUFZO0lBQ2pDO0FBQ0Y7QUFFQSx5QkFBeUI7QUFDbEIsU0FBU0MsaUJBQWlCbEIsS0FBYyxFQUFFbUIsU0FBaUI7SUFDaEUsTUFBTXJCLE1BQU1FO0lBUVpELFFBQVFDLEtBQUssQ0FBQyxDQUFDLG9CQUFvQixFQUFFbUIsVUFBVSxDQUFDLENBQUMsRUFBRTtRQUNqREMsU0FBU3RCLEtBQUtzQjtRQUNkQyxNQUFNdkIsS0FBS3VCO1FBQ1hDLFFBQVF4QixLQUFLd0I7UUFDYkMsTUFBTXpCLEtBQUt5QjtRQUNYQyxPQUFPMUIsS0FBSzBCO1FBQ1pDLE9BQU8zQixLQUFLMkI7SUFDZDtBQUNGO0FBRUEsZ0VBQWdFO0FBQ3pELFNBQVNDLGFBQWFDLFdBQW1CO0lBQzlDLHdEQUF3RDtJQUN4RCxPQUFPQSxZQUNKQyxPQUFPLENBQUMsdUNBQXVDLHVDQUMvQ0EsT0FBTyxDQUFDLHNCQUFzQix3QkFDOUJBLE9BQU8sQ0FBQyxzQkFBc0IseUJBQzlCQSxPQUFPLENBQUMsaUNBQWlDLHlDQUN6Q0EsT0FBTyxDQUFDLFdBQVc7QUFDeEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kci1ib3Jpc2xhdi1wZXRyb3Ytd2Vic2l0ZS8uL3NyYy9saWIvZGF0YWJhc2UudHM/YzFiMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQb29sLCBQb29sQ2xpZW50IH0gZnJvbSAncGcnXG5cbmxldCBwb29sOiBQb29sIHwgbnVsbCA9IG51bGxcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldERhdGFiYXNlKCk6IFByb21pc2U8UG9vbENsaWVudD4ge1xuICBpZiAoIXBvb2wpIHtcbiAgICBwb29sID0gbmV3IFBvb2woe1xuICAgICAgaG9zdDogcHJvY2Vzcy5lbnYuREJfSE9TVCB8fCAnMTkyLjE2OC4xLjEzNCcsXG4gICAgICBwb3J0OiBwYXJzZUludChwcm9jZXNzLmVudi5EQl9QT1JUIHx8ICc1NDMyJyksXG4gICAgICBkYXRhYmFzZTogcHJvY2Vzcy5lbnYuREJfTkFNRSB8fCAnZHJib3Jpc2xhdnBldHJvdicsXG4gICAgICB1c2VyOiBwcm9jZXNzLmVudi5EQl9VU0VSIHx8ICdkcmJvcmlzbGF2cGV0cm92JyxcbiAgICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5EQl9QQVNTV09SRCB8fCAnWGFuZGVyMTIzKSgqJyxcbiAgICAgIG1heDogMzAsIC8vINCj0LLQtdC70LjRh9Cw0LLQsNC80LUg0L7RgiAyMCDQvdCwIDMwXG4gICAgICBtaW46IDIsIC8vINCU0L7QsdCw0LLRj9C80LUg0LzQuNC90LjQvNCw0LvQtdC9INCx0YDQvtC5INCy0YDRitC30LrQuFxuICAgICAgaWRsZVRpbWVvdXRNaWxsaXM6IDYwMDAwLCAvLyDQo9Cy0LXQu9C40YfQsNCy0LDQvNC1INC+0YIgMzBzINC90LAgNjBzXG4gICAgICBjb25uZWN0aW9uVGltZW91dE1pbGxpczogMzAwMDAsIC8vINCj0LLQtdC70LjRh9Cw0LLQsNC80LUg0L7RgiAxMHMg0L3QsCAzMHNcbiAgICB9KVxuICAgIFxuICAgIC8vINCU0L7QsdCw0LLRj9C80LUgZXJyb3IgaGFuZGxpbmcg0LfQsCBwb29sXG4gICAgcG9vbC5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgVW5leHBlY3RlZCBlcnJvciBvbiBpZGxlIGNsaWVudCcsIGVycilcbiAgICB9KVxuICAgIFxuICAgIHBvb2wub24oJ2Nvbm5lY3QnLCAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygn4pyFIE5ldyBkYXRhYmFzZSBjb25uZWN0aW9uIGVzdGFibGlzaGVkJylcbiAgICB9KVxuICB9XG4gIFxuICB0cnkge1xuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IHBvb2wuY29ubmVjdCgpXG4gICAgXG4gICAgLy8gQ3JlYXRlIHRhYmxlcyBpZiB0aGV5IGRvbid0IGV4aXN0XG4gICAgYXdhaXQgY3JlYXRlVGFibGVzSWZOb3RFeGlzdChjbGllbnQpXG4gICAgXG4gICAgcmV0dXJuIGNsaWVudFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjb25uZWN0aW5nIHRvIGRhdGFiYXNlOicsIGVycm9yKVxuICAgIFxuICAgIC8vIFJldHJ5IGxvZ2ljXG4gICAgaWYgKHBvb2wpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SEIEF0dGVtcHRpbmcgdG8gcmVjcmVhdGUgcG9vbC4uLicpXG4gICAgICBhd2FpdCBwb29sLmVuZCgpXG4gICAgICBwb29sID0gbnVsbFxuICAgICAgXG4gICAgICAvLyBXYWl0IGEgYml0IGJlZm9yZSByZXRyeWluZ1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKVxuICAgICAgXG4gICAgICAvLyBSZWN1cnNpdmUgY2FsbCB0byByZWNyZWF0ZSBwb29sXG4gICAgICByZXR1cm4gZ2V0RGF0YWJhc2UoKVxuICAgIH1cbiAgICBcbiAgICB0aHJvdyBlcnJvclxuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRhYmxlc0lmTm90RXhpc3QoY2xpZW50OiBQb29sQ2xpZW50KSB7XG4gIHRyeSB7XG4gICAgLy8gQ3JlYXRlIGJvb2tpbmdzIHRhYmxlXG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KGBcbiAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGJvb2tpbmdzIChcbiAgICAgICAgaWQgU0VSSUFMIFBSSU1BUlkgS0VZLFxuICAgICAgICBuYW1lIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIGVtYWlsIFRFWFQsXG4gICAgICAgIHBob25lIFRFWFQsXG4gICAgICAgIHNlcnZpY2UgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgc2VydmljZWR1cmF0aW9uIElOVEVHRVIgREVGQVVMVCAzMCxcbiAgICAgICAgZGF0ZSBURVhUIE5PVCBOVUxMLFxuICAgICAgICB0aW1lIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIG1lc3NhZ2UgVEVYVCxcbiAgICAgICAgc3RhdHVzIFRFWFQgREVGQVVMVCAncGVuZGluZycgQ0hFQ0sgKHN0YXR1cyBJTiAoJ3BlbmRpbmcnLCAnY29uZmlybWVkJywgJ2NhbmNlbGxlZCcpKSxcbiAgICAgICAgdHJlYXRtZW50X25vdGVzIFRFWFQsXG4gICAgICAgIGNyZWF0ZWRhdCBUSU1FU1RBTVAgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgKVxuICAgIGApXG4gICAgXG4gICAgLy8gQ3JlYXRlIHVzZXJzIHRhYmxlIHdpdGggcGhvbmUgYXMgdW5pcXVlIGlkZW50aWZpZXIgKGJ1dCBhbGxvd2luZyBOVUxMIGZvciBhZG1pbiB1c2VycylcbiAgICBhd2FpdCBjbGllbnQucXVlcnkoYFxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdXNlcnMgKFxuICAgICAgICBpZCBTRVJJQUwgUFJJTUFSWSBLRVksXG4gICAgICAgIG5hbWUgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgZW1haWwgVEVYVCxcbiAgICAgICAgcGhvbmUgVEVYVCBVTklRVUUgTlVMTCxcbiAgICAgICAgYWRkcmVzcyBURVhULFxuICAgICAgICBub3RlcyBURVhULFxuICAgICAgICBjcmVhdGVkQXQgVElNRVNUQU1QIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVAsXG4gICAgICAgIHVwZGF0ZWRBdCBUSU1FU1RBTVAgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgKVxuICAgIGApXG4gICAgXG4gICAgLy8gQWx0ZXIgZXhpc3RpbmcgdGFibGUgdG8gYWxsb3cgTlVMTCB2YWx1ZXMgZm9yIHBob25lIChpZiBjb25zdHJhaW50IGV4aXN0cylcbiAgICB0cnkge1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KGBcbiAgICAgICAgQUxURVIgVEFCTEUgdXNlcnMgXG4gICAgICAgIEFMVEVSIENPTFVNTiBwaG9uZSBEUk9QIE5PVCBOVUxMXG4gICAgICBgKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBDb2x1bW4gbWlnaHQgYWxyZWFkeSBhbGxvdyBOVUxMIG9yIGNvbnN0cmFpbnQgZG9lc24ndCBleGlzdFxuICAgICAgY29uc29sZS5sb2coJ1Bob25lIGNvbHVtbiBhbHJlYWR5IGFsbG93cyBOVUxMIG9yIGNvbnN0cmFpbnQgbm90IGZvdW5kJylcbiAgICB9XG4gICAgXG4gICAgLy8gQ3JlYXRlIHNlcnZpY2VzIHRhYmxlXG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KGBcbiAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHNlcnZpY2VzIChcbiAgICAgICAgaWQgU0VSSUFMIFBSSU1BUlkgS0VZLFxuICAgICAgICBuYW1lIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIGRlc2NyaXB0aW9uIFRFWFQsXG4gICAgICAgIGR1cmF0aW9uIElOVEVHRVIgTk9UIE5VTEwgREVGQVVMVCAzMCxcbiAgICAgICAgcHJpY2UgUkVBTCxcbiAgICAgICAgaXNBY3RpdmUgQk9PTEVBTiBERUZBVUxUIHRydWUsXG4gICAgICAgIGNyZWF0ZWRBdCBUSU1FU1RBTVAgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgKVxuICAgIGApXG4gICAgXG4gICAgLy8gQ3JlYXRlIHdvcmtpbmcgaG91cnMgdGFibGVcbiAgICBhd2FpdCBjbGllbnQucXVlcnkoYFxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgd29ya2luZ19ob3VycyAoXG4gICAgICAgIGlkIFNFUklBTCBQUklNQVJZIEtFWSxcbiAgICAgICAgZGF0ZSBURVhUIE5PVCBOVUxMIFVOSVFVRSxcbiAgICAgICAgaXNfd29ya2luZ19kYXkgQk9PTEVBTiBERUZBVUxUIHRydWUsXG4gICAgICAgIHN0YXJ0X3RpbWUgVEVYVCBERUZBVUxUICcwOTowMCcsXG4gICAgICAgIGVuZF90aW1lIFRFWFQgREVGQVVMVCAnMTg6MDAnLFxuICAgICAgICBub3RlcyBURVhULFxuICAgICAgICBjcmVhdGVkX2F0IFRJTUVTVEFNUCBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QXG4gICAgICApXG4gICAgYClcbiAgICBcbiAgICAvLyBDcmVhdGUgYnJlYWtzIHRhYmxlIGZvciBtdWx0aXBsZSBicmVha3MgcGVyIGRheVxuICAgIGF3YWl0IGNsaWVudC5xdWVyeShgXG4gICAgICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyB3b3JraW5nX2JyZWFrcyAoXG4gICAgICAgIGlkIFNFUklBTCBQUklNQVJZIEtFWSxcbiAgICAgICAgd29ya2luZ19ob3Vyc19pZCBJTlRFR0VSIFJFRkVSRU5DRVMgd29ya2luZ19ob3VycyhpZCkgT04gREVMRVRFIENBU0NBREUsXG4gICAgICAgIHN0YXJ0X3RpbWUgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgZW5kX3RpbWUgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgZGVzY3JpcHRpb24gVEVYVCBERUZBVUxUICfQn9C+0YfQuNCy0LrQsCcsXG4gICAgICAgIGNyZWF0ZWRfYXQgVElNRVNUQU1QIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVBcbiAgICAgIClcbiAgICBgKVxuICAgIFxuICAgIC8vIENyZWF0ZSBidWcgdHJhY2tpbmcgdGFibGVzXG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KGBcbiAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGJ1Z19yZXBvcnRzIChcbiAgICAgICAgaWQgU0VSSUFMIFBSSU1BUlkgS0VZLFxuICAgICAgICB0aXRsZSBURVhUIE5PVCBOVUxMLFxuICAgICAgICBkZXNjcmlwdGlvbiBURVhUIE5PVCBOVUxMLFxuICAgICAgICBzZXZlcml0eSBURVhUIENIRUNLIChzZXZlcml0eSBJTiAoJ2xvdycsICdtZWRpdW0nLCAnaGlnaCcsICdjcml0aWNhbCcpKSxcbiAgICAgICAgc3RhdHVzIFRFWFQgREVGQVVMVCAnb3BlbicgQ0hFQ0sgKHN0YXR1cyBJTiAoJ29wZW4nLCAnaW4tcHJvZ3Jlc3MnLCAncmVzb2x2ZWQnLCAnY2xvc2VkJykpLFxuICAgICAgICBjYXRlZ29yeSBURVhUIENIRUNLIChjYXRlZ29yeSBJTiAoJ3VpJywgJ2Z1bmN0aW9uYWxpdHknLCAncGVyZm9ybWFuY2UnLCAnc2VjdXJpdHknLCAnZGF0YWJhc2UnKSksXG4gICAgICAgIHByaW9yaXR5IFRFWFQgREVGQVVMVCAnbWVkaXVtJyBDSEVDSyAocHJpb3JpdHkgSU4gKCdsb3cnLCAnbWVkaXVtJywgJ2hpZ2gnLCAndXJnZW50JykpLFxuICAgICAgICByZXBvcnRlciBURVhUIE5PVCBOVUxMLFxuICAgICAgICBhc3NpZ25lZF90byBURVhULFxuICAgICAgICBjcmVhdGVkX2F0IFRJTUVTVEFNUCBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QLFxuICAgICAgICB1cGRhdGVkX2F0IFRJTUVTVEFNUCBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QLFxuICAgICAgICBzdGVwc190b19yZXByb2R1Y2UgVEVYVFtdLFxuICAgICAgICBleHBlY3RlZF9iZWhhdmlvciBURVhULFxuICAgICAgICBhY3R1YWxfYmVoYXZpb3IgVEVYVCxcbiAgICAgICAgYnJvd3NlciBURVhULFxuICAgICAgICBkZXZpY2UgVEVYVCxcbiAgICAgICAgc2NyZWVuc2hvdHMgVEVYVFtdLFxuICAgICAgICB0YWdzIFRFWFRbXVxuICAgICAgKVxuICAgIGApXG4gICAgXG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KGBcbiAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGJ1Z19jb21tZW50cyAoXG4gICAgICAgIGlkIFNFUklBTCBQUklNQVJZIEtFWSxcbiAgICAgICAgYnVnX2lkIElOVEVHRVIgUkVGRVJFTkNFUyBidWdfcmVwb3J0cyhpZCkgT04gREVMRVRFIENBU0NBREUsXG4gICAgICAgIGF1dGhvciBURVhUIE5PVCBOVUxMLFxuICAgICAgICBjb250ZW50IFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIGNyZWF0ZWRfYXQgVElNRVNUQU1QIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVAsXG4gICAgICAgIGlzX2ludGVybmFsIEJPT0xFQU4gREVGQVVMVCBmYWxzZVxuICAgICAgKVxuICAgIGApXG4gICAgXG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KGBcbiAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGJ1Z19hdHRhY2htZW50cyAoXG4gICAgICAgIGlkIFNFUklBTCBQUklNQVJZIEtFWSxcbiAgICAgICAgYnVnX2lkIElOVEVHRVIgUkVGRVJFTkNFUyBidWdfcmVwb3J0cyhpZCkgT04gREVMRVRFIENBU0NBREUsXG4gICAgICAgIGZpbGVuYW1lIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIHVybCBURVhUIE5PVCBOVUxMLFxuICAgICAgICBzaXplIElOVEVHRVIgTk9UIE5VTEwsXG4gICAgICAgIHVwbG9hZGVkX2F0IFRJTUVTVEFNUCBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QXG4gICAgICApXG4gICAgYClcbiAgICBcbiAgICAvLyBJbnNlcnQgZGVmYXVsdCBzZXJ2aWNlcyBpZiB0YWJsZSBpcyBlbXB0eVxuICAgIGNvbnN0IHNlcnZpY2VzQ291bnQgPSBhd2FpdCBjbGllbnQucXVlcnkoJ1NFTEVDVCBDT1VOVCgqKSBhcyBjb3VudCBGUk9NIHNlcnZpY2VzJylcbiAgICBpZiAocGFyc2VJbnQoc2VydmljZXNDb3VudC5yb3dzWzBdLmNvdW50KSA9PT0gMCkge1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KGBcbiAgICAgICAgSU5TRVJUIElOVE8gc2VydmljZXMgKG5hbWUsIGRlc2NyaXB0aW9uLCBkdXJhdGlvbiwgcHJpY2UpIFZBTFVFU1xuICAgICAgICAoJ9Cf0YDQtdCz0LvQtdC0INC4INC60L7QvdGB0YPQu9GC0LDRhtC40Y8nLCAn0J7RgdC90L7QstC10L0g0L/RgNC10LPQu9C10LQg0L3QsCDQt9GK0LHQuNGC0LUg0Lgg0LrQvtC90YHRg9C70YLQsNGG0LjRjycsIDMwLCA1MC4wMCksXG4gICAgICAgICgn0J/QvtGH0LjRgdGC0LLQsNC90LUg0Lgg0L/RgNC+0YTQuNC70LDQutGC0LjQutCwJywgJ9Cf0YDQvtGE0LXRgdC40L7QvdCw0LvQvdC+INC/0L7Rh9C40YHRgtCy0LDQvdC1INC90LAg0LfRitCx0LXQvSDQutCw0LzRitC6JywgNDUsIDgwLjAwKSxcbiAgICAgICAgKCfQm9C10YfQtdC90LjQtSDQvdCwINC60LDRgNC40LXRgScsICfQm9C10YfQtdC90LjQtSDQvdCwINC60LDRgNC40LXRgSDRgSDQvNC+0LTQtdGA0L3QuCDQvNCw0YLQtdGA0LjQsNC70LgnLCA2MCwgMTIwLjAwKSxcbiAgICAgICAgKCfQntGC0LHQtdC70Y/Qt9Cy0LDQvdC1JywgJ9Cf0YDQvtGE0LXRgdC40L7QvdCw0LvQvdC+INC+0YLQsdC10LvRj9C30LLQsNC90LUg0L3QsCDQt9GK0LHQuNGC0LUnLCA5MCwgMjAwLjAwKSxcbiAgICAgICAgKCfQntGA0YLQvtC00L7QvdGC0LjRjycsICfQmtC+0L3RgdGD0LvRgtCw0YbQuNGPINC30LAg0L7RgNGC0L7QtNC+0L3RgtGB0LrQuCDQu9C10YfQtdC90LjQtScsIDQ1LCAxMDAuMDApXG4gICAgICBgKVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyB0YWJsZXM6JywgZXJyb3IpXG4gICAgdGhyb3cgZXJyb3JcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xvc2VEYXRhYmFzZSgpIHtcbiAgaWYgKHBvb2wpIHtcbiAgICBhd2FpdCBwb29sLmVuZCgpXG4gICAgcG9vbCA9IG51bGxcbiAgfVxufVxuXG4vLyBEYXRhYmFzZSBwb29sIG1vbml0b3JpbmcgZnVuY3Rpb25cbmV4cG9ydCBmdW5jdGlvbiBnZXRQb29sU3RhdHVzKCkge1xuICBpZiAoIXBvb2wpIHJldHVybiBudWxsXG4gIHJldHVybiB7XG4gICAgdG90YWxDb3VudDogcG9vbC50b3RhbENvdW50LFxuICAgIGlkbGVDb3VudDogcG9vbC5pZGxlQ291bnQsXG4gICAgd2FpdGluZ0NvdW50OiBwb29sLndhaXRpbmdDb3VudFxuICB9XG59XG5cbi8vIEVuaGFuY2VkIGVycm9yIGxvZ2dpbmdcbmV4cG9ydCBmdW5jdGlvbiBsb2dEYXRhYmFzZUVycm9yKGVycm9yOiB1bmtub3duLCBvcGVyYXRpb246IHN0cmluZykge1xuICBjb25zdCBlcnIgPSBlcnJvciBhcyBQYXJ0aWFsPHtcbiAgICBtZXNzYWdlOiBzdHJpbmdcbiAgICBjb2RlOiBzdHJpbmcgfCBudW1iZXJcbiAgICBkZXRhaWw6IHN0cmluZ1xuICAgIGhpbnQ6IHN0cmluZ1xuICAgIHdoZXJlOiBzdHJpbmdcbiAgICBzdGFjazogc3RyaW5nXG4gIH0+XG4gIGNvbnNvbGUuZXJyb3IoYOKdjCBEYXRhYmFzZSBlcnJvciBpbiAke29wZXJhdGlvbn06YCwge1xuICAgIG1lc3NhZ2U6IGVycj8ubWVzc2FnZSxcbiAgICBjb2RlOiBlcnI/LmNvZGUsXG4gICAgZGV0YWlsOiBlcnI/LmRldGFpbCxcbiAgICBoaW50OiBlcnI/LmhpbnQsXG4gICAgd2hlcmU6IGVycj8ud2hlcmUsXG4gICAgc3RhY2s6IGVycj8uc3RhY2tcbiAgfSlcbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgU1FMaXRlLXN0eWxlIHF1ZXJpZXMgdG8gUG9zdGdyZVNRTFxuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRRdWVyeShzcWxpdGVRdWVyeTogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gUmVwbGFjZSBTUUxpdGUtc3BlY2lmaWMgc3ludGF4IHdpdGggUG9zdGdyZVNRTCBzeW50YXhcbiAgcmV0dXJuIHNxbGl0ZVF1ZXJ5XG4gICAgLnJlcGxhY2UoL0RBVEVUSU1FIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVAvZywgJ1RJTUVTVEFNUCBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QJylcbiAgICAucmVwbGFjZSgvQk9PTEVBTiBERUZBVUxUIDEvZywgJ0JPT0xFQU4gREVGQVVMVCB0cnVlJylcbiAgICAucmVwbGFjZSgvQk9PTEVBTiBERUZBVUxUIDAvZywgJ0JPT0xFQU4gREVGQVVMVCBmYWxzZScpXG4gICAgLnJlcGxhY2UoL2RhdGV0aW1lXFwoJ25vdycsICctNyBkYXlzJ1xcKS9nLCBcIkNVUlJFTlRfVElNRVNUQU1QIC0gSU5URVJWQUwgJzcgZGF5cydcIilcbiAgICAucmVwbGFjZSgvREFURVxcKC9nLCAnREFURSgnKVxufSAiXSwibmFtZXMiOlsiUG9vbCIsInBvb2wiLCJnZXREYXRhYmFzZSIsImhvc3QiLCJwcm9jZXNzIiwiZW52IiwiREJfSE9TVCIsInBvcnQiLCJwYXJzZUludCIsIkRCX1BPUlQiLCJkYXRhYmFzZSIsIkRCX05BTUUiLCJ1c2VyIiwiREJfVVNFUiIsInBhc3N3b3JkIiwiREJfUEFTU1dPUkQiLCJtYXgiLCJtaW4iLCJpZGxlVGltZW91dE1pbGxpcyIsImNvbm5lY3Rpb25UaW1lb3V0TWlsbGlzIiwib24iLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJsb2ciLCJjbGllbnQiLCJjb25uZWN0IiwiY3JlYXRlVGFibGVzSWZOb3RFeGlzdCIsImVuZCIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInF1ZXJ5Iiwic2VydmljZXNDb3VudCIsInJvd3MiLCJjb3VudCIsImNsb3NlRGF0YWJhc2UiLCJnZXRQb29sU3RhdHVzIiwidG90YWxDb3VudCIsImlkbGVDb3VudCIsIndhaXRpbmdDb3VudCIsImxvZ0RhdGFiYXNlRXJyb3IiLCJvcGVyYXRpb24iLCJtZXNzYWdlIiwiY29kZSIsImRldGFpbCIsImhpbnQiLCJ3aGVyZSIsInN0YWNrIiwiY29udmVydFF1ZXJ5Iiwic3FsaXRlUXVlcnkiLCJyZXBsYWNlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/database.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/socket.ts":
/*!***************************!*\
  !*** ./src/lib/socket.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   emitBookingAdded: () => (/* binding */ emitBookingAdded),\n/* harmony export */   emitBookingDeleted: () => (/* binding */ emitBookingDeleted),\n/* harmony export */   emitBookingUpdate: () => (/* binding */ emitBookingUpdate),\n/* harmony export */   emitNextBookingChanged: () => (/* binding */ emitNextBookingChanged),\n/* harmony export */   emitServiceAdded: () => (/* binding */ emitServiceAdded),\n/* harmony export */   emitServiceDeleted: () => (/* binding */ emitServiceDeleted),\n/* harmony export */   emitServiceUpdate: () => (/* binding */ emitServiceUpdate),\n/* harmony export */   emitUserAdded: () => (/* binding */ emitUserAdded),\n/* harmony export */   emitUserDeleted: () => (/* binding */ emitUserDeleted),\n/* harmony export */   emitUserUpdate: () => (/* binding */ emitUserUpdate),\n/* harmony export */   emitWorkingHoursUpdated: () => (/* binding */ emitWorkingHoursUpdated),\n/* harmony export */   getIO: () => (/* binding */ getIO)\n/* harmony export */ });\n// Global socket.io instance\nfunction getIO() {\n    if (!globalThis.io) {\n        console.warn(\"⚠️ Socket.io not initialized yet\");\n        return null;\n    }\n    return globalThis.io;\n}\n// Helper functions to emit events with improved error handling\nfunction emitBookingUpdate(booking) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting booking-updated event:\", booking);\n        socketIO.to(\"admin\").emit(\"booking-updated\", booking);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for booking-updated event\");\n    }\n}\nfunction emitBookingAdded(booking) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting booking-added event:\", booking);\n        socketIO.to(\"admin\").emit(\"booking-added\", booking);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for booking-added event\");\n    }\n}\nfunction emitBookingDeleted(bookingId) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting booking-deleted event:\", bookingId);\n        socketIO.to(\"admin\").emit(\"booking-deleted\", bookingId);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for booking-deleted event\");\n    }\n}\nfunction emitNextBookingChanged(booking) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting next-booking-changed event:\", booking);\n        socketIO.to(\"admin\").emit(\"next-booking-changed\", booking);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for next-booking-changed event\");\n    }\n}\nfunction emitUserAdded(user) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting user-added event:\", user);\n        socketIO.to(\"admin\").emit(\"user-added\", user);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for user-added event\");\n    }\n}\nfunction emitUserUpdate(user) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting user-updated event:\", user);\n        socketIO.to(\"admin\").emit(\"user-updated\", user);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for user-updated event\");\n    }\n}\nfunction emitUserDeleted(userId) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting user-deleted event:\", userId);\n        socketIO.to(\"admin\").emit(\"user-deleted\", userId);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for user-deleted event\");\n    }\n}\nfunction emitServiceAdded(service) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting service-added event:\", service);\n        socketIO.to(\"admin\").emit(\"service-added\", service);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for service-added event\");\n    }\n}\nfunction emitServiceUpdate(service) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting service-updated event:\", service);\n        socketIO.to(\"admin\").emit(\"service-updated\", service);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for service-updated event\");\n    }\n}\nfunction emitServiceDeleted(serviceId) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting service-deleted event:\", serviceId);\n        socketIO.to(\"admin\").emit(\"service-deleted\", serviceId);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for service-deleted event\");\n    }\n}\nfunction emitWorkingHoursUpdated(workingHours) {\n    const socketIO = getIO();\n    if (socketIO) {\n        console.log(\"\\uD83D\\uDCE1 Emitting working-hours-updated event:\", workingHours);\n        socketIO.to(\"admin\").emit(\"working-hours-updated\", workingHours);\n    } else {\n        console.warn(\"⚠️ Socket.io not available for working-hours-updated event\");\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFBUUMsSUFBSSxDQUFDO0lBQ2Y7QUFDRjtBQUVPLFNBQVNtQixtQkFBbUJDLFNBQWlCO0lBQ2xELE1BQU1qQixXQUFXUDtJQUNqQixJQUFJTyxVQUFVO1FBQ1pKLFFBQVFLLEdBQUcsQ0FBQyxnREFBc0NnQjtRQUNsRGpCLFNBQVNFLEVBQUUsQ0FBQyxTQUFTQyxJQUFJLENBQUMsbUJBQW1CYztJQUMvQyxPQUFPO1FBQ0xyQixRQUFRQyxJQUFJLENBQUM7SUFDZjtBQUNGO0FBRU8sU0FBU3FCLHdCQUF3QkMsWUFBcUI7SUFDM0QsTUFBTW5CLFdBQVdQO0lBQ2pCLElBQUlPLFVBQVU7UUFDWkosUUFBUUssR0FBRyxDQUFDLHNEQUE0Q2tCO1FBQ3hEbkIsU0FBU0UsRUFBRSxDQUFDLFNBQVNDLElBQUksQ0FBQyx5QkFBeUJnQjtJQUNyRCxPQUFPO1FBQ0x2QixRQUFRQyxJQUFJLENBQUM7SUFDZjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZHItYm9yaXNsYXYtcGV0cm92LXdlYnNpdGUvLi9zcmMvbGliL3NvY2tldC50cz84NDA0Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIEdsb2JhbCBzb2NrZXQuaW8gaW5zdGFuY2VcbmRlY2xhcmUgZ2xvYmFsIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXZhclxuICB2YXIgaW86IGltcG9ydCgnc29ja2V0LmlvJykuU2VydmVyIHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SU8oKTogaW1wb3J0KCdzb2NrZXQuaW8nKS5TZXJ2ZXIgfCBudWxsIHtcbiAgaWYgKCFnbG9iYWxUaGlzLmlvKSB7XG4gICAgY29uc29sZS53YXJuKCfimqDvuI8gU29ja2V0LmlvIG5vdCBpbml0aWFsaXplZCB5ZXQnKVxuICAgIHJldHVybiBudWxsXG4gIH1cbiAgcmV0dXJuIGdsb2JhbFRoaXMuaW9cbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9ucyB0byBlbWl0IGV2ZW50cyB3aXRoIGltcHJvdmVkIGVycm9yIGhhbmRsaW5nXG5leHBvcnQgZnVuY3Rpb24gZW1pdEJvb2tpbmdVcGRhdGUoYm9va2luZzogdW5rbm93bikge1xuICBjb25zdCBzb2NrZXRJTyA9IGdldElPKClcbiAgaWYgKHNvY2tldElPKSB7XG4gICAgY29uc29sZS5sb2coJ/Cfk6EgRW1pdHRpbmcgYm9va2luZy11cGRhdGVkIGV2ZW50OicsIGJvb2tpbmcpXG4gICAgc29ja2V0SU8udG8oJ2FkbWluJykuZW1pdCgnYm9va2luZy11cGRhdGVkJywgYm9va2luZylcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBTb2NrZXQuaW8gbm90IGF2YWlsYWJsZSBmb3IgYm9va2luZy11cGRhdGVkIGV2ZW50JylcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZW1pdEJvb2tpbmdBZGRlZChib29raW5nOiB1bmtub3duKSB7XG4gIGNvbnN0IHNvY2tldElPID0gZ2V0SU8oKVxuICBpZiAoc29ja2V0SU8pIHtcbiAgICBjb25zb2xlLmxvZygn8J+ToSBFbWl0dGluZyBib29raW5nLWFkZGVkIGV2ZW50OicsIGJvb2tpbmcpXG4gICAgc29ja2V0SU8udG8oJ2FkbWluJykuZW1pdCgnYm9va2luZy1hZGRlZCcsIGJvb2tpbmcpXG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKCfimqDvuI8gU29ja2V0LmlvIG5vdCBhdmFpbGFibGUgZm9yIGJvb2tpbmctYWRkZWQgZXZlbnQnKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbWl0Qm9va2luZ0RlbGV0ZWQoYm9va2luZ0lkOiBzdHJpbmcpIHtcbiAgY29uc3Qgc29ja2V0SU8gPSBnZXRJTygpXG4gIGlmIChzb2NrZXRJTykge1xuICAgIGNvbnNvbGUubG9nKCfwn5OhIEVtaXR0aW5nIGJvb2tpbmctZGVsZXRlZCBldmVudDonLCBib29raW5nSWQpXG4gICAgc29ja2V0SU8udG8oJ2FkbWluJykuZW1pdCgnYm9va2luZy1kZWxldGVkJywgYm9va2luZ0lkKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFNvY2tldC5pbyBub3QgYXZhaWxhYmxlIGZvciBib29raW5nLWRlbGV0ZWQgZXZlbnQnKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbWl0TmV4dEJvb2tpbmdDaGFuZ2VkKGJvb2tpbmc6IHVua25vd24pIHtcbiAgY29uc3Qgc29ja2V0SU8gPSBnZXRJTygpXG4gIGlmIChzb2NrZXRJTykge1xuICAgIGNvbnNvbGUubG9nKCfwn5OhIEVtaXR0aW5nIG5leHQtYm9va2luZy1jaGFuZ2VkIGV2ZW50OicsIGJvb2tpbmcpXG4gICAgc29ja2V0SU8udG8oJ2FkbWluJykuZW1pdCgnbmV4dC1ib29raW5nLWNoYW5nZWQnLCBib29raW5nKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFNvY2tldC5pbyBub3QgYXZhaWxhYmxlIGZvciBuZXh0LWJvb2tpbmctY2hhbmdlZCBldmVudCcpXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVtaXRVc2VyQWRkZWQodXNlcjogdW5rbm93bikge1xuICBjb25zdCBzb2NrZXRJTyA9IGdldElPKClcbiAgaWYgKHNvY2tldElPKSB7XG4gICAgY29uc29sZS5sb2coJ/Cfk6EgRW1pdHRpbmcgdXNlci1hZGRlZCBldmVudDonLCB1c2VyKVxuICAgIHNvY2tldElPLnRvKCdhZG1pbicpLmVtaXQoJ3VzZXItYWRkZWQnLCB1c2VyKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFNvY2tldC5pbyBub3QgYXZhaWxhYmxlIGZvciB1c2VyLWFkZGVkIGV2ZW50JylcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZW1pdFVzZXJVcGRhdGUodXNlcjogdW5rbm93bikge1xuICBjb25zdCBzb2NrZXRJTyA9IGdldElPKClcbiAgaWYgKHNvY2tldElPKSB7XG4gICAgY29uc29sZS5sb2coJ/Cfk6EgRW1pdHRpbmcgdXNlci11cGRhdGVkIGV2ZW50OicsIHVzZXIpXG4gICAgc29ja2V0SU8udG8oJ2FkbWluJykuZW1pdCgndXNlci11cGRhdGVkJywgdXNlcilcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBTb2NrZXQuaW8gbm90IGF2YWlsYWJsZSBmb3IgdXNlci11cGRhdGVkIGV2ZW50JylcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZW1pdFVzZXJEZWxldGVkKHVzZXJJZDogc3RyaW5nKSB7XG4gIGNvbnN0IHNvY2tldElPID0gZ2V0SU8oKVxuICBpZiAoc29ja2V0SU8pIHtcbiAgICBjb25zb2xlLmxvZygn8J+ToSBFbWl0dGluZyB1c2VyLWRlbGV0ZWQgZXZlbnQ6JywgdXNlcklkKVxuICAgIHNvY2tldElPLnRvKCdhZG1pbicpLmVtaXQoJ3VzZXItZGVsZXRlZCcsIHVzZXJJZClcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBTb2NrZXQuaW8gbm90IGF2YWlsYWJsZSBmb3IgdXNlci1kZWxldGVkIGV2ZW50JylcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZW1pdFNlcnZpY2VBZGRlZChzZXJ2aWNlOiB1bmtub3duKSB7XG4gIGNvbnN0IHNvY2tldElPID0gZ2V0SU8oKVxuICBpZiAoc29ja2V0SU8pIHtcbiAgICBjb25zb2xlLmxvZygn8J+ToSBFbWl0dGluZyBzZXJ2aWNlLWFkZGVkIGV2ZW50OicsIHNlcnZpY2UpXG4gICAgc29ja2V0SU8udG8oJ2FkbWluJykuZW1pdCgnc2VydmljZS1hZGRlZCcsIHNlcnZpY2UpXG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKCfimqDvuI8gU29ja2V0LmlvIG5vdCBhdmFpbGFibGUgZm9yIHNlcnZpY2UtYWRkZWQgZXZlbnQnKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbWl0U2VydmljZVVwZGF0ZShzZXJ2aWNlOiB1bmtub3duKSB7XG4gIGNvbnN0IHNvY2tldElPID0gZ2V0SU8oKVxuICBpZiAoc29ja2V0SU8pIHtcbiAgICBjb25zb2xlLmxvZygn8J+ToSBFbWl0dGluZyBzZXJ2aWNlLXVwZGF0ZWQgZXZlbnQ6Jywgc2VydmljZSlcbiAgICBzb2NrZXRJTy50bygnYWRtaW4nKS5lbWl0KCdzZXJ2aWNlLXVwZGF0ZWQnLCBzZXJ2aWNlKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFNvY2tldC5pbyBub3QgYXZhaWxhYmxlIGZvciBzZXJ2aWNlLXVwZGF0ZWQgZXZlbnQnKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbWl0U2VydmljZURlbGV0ZWQoc2VydmljZUlkOiBzdHJpbmcpIHtcbiAgY29uc3Qgc29ja2V0SU8gPSBnZXRJTygpXG4gIGlmIChzb2NrZXRJTykge1xuICAgIGNvbnNvbGUubG9nKCfwn5OhIEVtaXR0aW5nIHNlcnZpY2UtZGVsZXRlZCBldmVudDonLCBzZXJ2aWNlSWQpXG4gICAgc29ja2V0SU8udG8oJ2FkbWluJykuZW1pdCgnc2VydmljZS1kZWxldGVkJywgc2VydmljZUlkKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFNvY2tldC5pbyBub3QgYXZhaWxhYmxlIGZvciBzZXJ2aWNlLWRlbGV0ZWQgZXZlbnQnKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbWl0V29ya2luZ0hvdXJzVXBkYXRlZCh3b3JraW5nSG91cnM6IHVua25vd24pIHtcbiAgY29uc3Qgc29ja2V0SU8gPSBnZXRJTygpXG4gIGlmIChzb2NrZXRJTykge1xuICAgIGNvbnNvbGUubG9nKCfwn5OhIEVtaXR0aW5nIHdvcmtpbmctaG91cnMtdXBkYXRlZCBldmVudDonLCB3b3JraW5nSG91cnMpXG4gICAgc29ja2V0SU8udG8oJ2FkbWluJykuZW1pdCgnd29ya2luZy1ob3Vycy11cGRhdGVkJywgd29ya2luZ0hvdXJzKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFNvY2tldC5pbyBub3QgYXZhaWxhYmxlIGZvciB3b3JraW5nLWhvdXJzLXVwZGF0ZWQgZXZlbnQnKVxuICB9XG59ICJdLCJuYW1lcyI6WyJnZXRJTyIsImdsb2JhbFRoaXMiLCJpbyIsImNvbnNvbGUiLCJ3YXJuIiwiZW1pdEJvb2tpbmdVcGRhdGUiLCJib29raW5nIiwic29ja2V0SU8iLCJsb2ciLCJ0byIsImVtaXQiLCJlbWl0Qm9va2luZ0FkZGVkIiwiZW1pdEJvb2tpbmdEZWxldGVkIiwiYm9va2luZ0lkIiwiZW1pdE5leHRCb29raW5nQ2hhbmdlZCIsImVtaXRVc2VyQWRkZWQiLCJ1c2VyIiwiZW1pdFVzZXJVcGRhdGUiLCJlbWl0VXNlckRlbGV0ZWQiLCJ1c2VySWQiLCJlbWl0U2VydmljZUFkZGVkIiwic2VydmljZSIsImVtaXRTZXJ2aWNlVXBkYXRlIiwiZW1pdFNlcnZpY2VEZWxldGVkIiwic2VydmljZUlkIiwiZW1pdFdvcmtpbmdIb3Vyc1VwZGF0ZWQiLCJ3b3JraW5nSG91cnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/socket.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fbookings%2Froute&page=%2Fapi%2Fadmin%2Fbookings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fbookings%2Froute.ts&appDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cgenius%5CDownloads%5Cdrborislavpetrov&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();